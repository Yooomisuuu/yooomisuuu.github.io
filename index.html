<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶≠</text></svg>">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yomi's World</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Comic Sans MS", "Arial Rounded MT Bold", sans-serif; }
        body { background: #ffe6f2 url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23ffb3d9" fill-opacity="0.2" d="M30,10 Q50,0 70,10 Q90,20 90,40 Q90,60 70,70 Q50,80 30,70 Q10,60 10,40 Q10,20 30,10 Z"/></svg>'); color: #5a2e48; overflow-x: hidden; position: relative; }
        
        /* ‰æßËæπÊ†è */
        .sidebar { position: fixed; left: 0; top: 0; height: 100vh; width: 220px; background: #ff99cc; padding: 30px 15px; box-shadow: 2px 0 10px rgba(0,0,0,0.1); z-index: 999; }
        .sidebar h2 { color: white; text-align: center; margin-bottom: 40px; font-size: 20px; text-shadow: 1px 1px 2px #ff66b3; }
        .sidebar-btn { display: block; width: 100%; padding: 12px 15px; margin: 10px 0; background: white; border: none; border-radius: 20px; color: #ff66b3; font-size: 14px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .sidebar-btn:hover { background: #ff66b3; color: white; transform: translateX(5px); }
        
        /* ÁôªÂΩïÂå∫Âüü */
        .login-section { text-align: center; margin-bottom: 20px; }
        .login-btn { padding: 10px 15px; background: #ff66b3; color: white; border: none; border-radius: 20px; cursor: pointer; width: 100%; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .login-btn:hover { background: #ff3399; transform: scale(1.05); }
        
        /* ‰∏ªÂÜÖÂÆπÂå∫ */
        .main-content { margin-left: 220px; padding: 40px; min-height: 100vh; position: relative; }
        .page-title { color: #ff66b3; font-size: 26px; margin-bottom: 30px; text-align: center; text-shadow: 1px 1px 3px #ffb3d9; }
        .content-section { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 5px 15px rgba(255, 102, 179, 0.1); margin-bottom: 30px; }
        .section-title { color: #ff66b3; font-size: 20px; margin-bottom: 1rem; border-bottom: 2px solid #ffb3d9; padding-bottom: 0.5rem; text-shadow: 1px 1px 2px #ffd6e8; }
        
        /* ÊåâÈíÆÊ†∑Âºè */
        .add-folder-btn, .add-target-btn { display: inline-block; padding: 10px 20px; background: #ff66b3; color: white; border: none; border-radius: 20px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .add-folder-btn:hover, .add-target-btn:hover { background: #ff3399; transform: scale(1.05); }
        .add-target-btn { position: absolute; top: 25px; right: 25px; }
        
        /* Êñá‰ª∂Â§π/Êñá‰ª∂Ê†∑Âºè */
        .media-section { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1.5rem; margin-top: 1rem; padding: 1rem; background: #fff8fc; border-radius: 15px; border: 1px solid #ffd6e8; }
        .folder-item, .file-item { display: flex; flex-direction: column; align-items: center; padding: 1rem; border-radius: 12px; background: #fff; border: 1px solid #ffd6e8; cursor: pointer; transition: all 0.2s ease; position: relative; height: 160px; justify-content: center; }
        .folder-item:hover, .file-item:hover { background: #fff0f7; border-color: #ff66b3; box-shadow: 0 4px 12px rgba(255, 102, 179, 0.15); }
        .folder-icon, .file-icon { width: 70px; height: 70px; object-fit: contain; margin-bottom: 0.8rem; border-radius: 8px; }
        .folder-name, .file-name { width: 100%; text-align: center; padding: 4px 8px; border-radius: 8px; font-size: 14px; color: #5a2e48; word-break: break-word; max-height: 40px; overflow: hidden; }
        .file-name { font-size: 13px; }
        
        /* Âà†Èô§ÊåâÈíÆ */
        .delete-folder, .delete-file { position: absolute; top: 8px; right: 8px; background: #ff6666; color: white; border: none; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; font-size: 12px; opacity: 0.8; }
        .delete-folder:hover, .delete-file:hover { background: #ff3333; transform: scale(1.1); opacity: 1; }
        
        /* ÁõÆÊ†áÊ†∑Âºè */
        .year-target-container { margin: 15px 0; padding: 15px; background: #fff8fc; border-radius: 15px; border: 1px solid #ffd6e8; }
        .year-header { display: flex; align-items: center; margin-bottom: 10px; font-size: 18px; color: #ff66b3; }
        .year-checkbox { margin-right: 10px; width: 20px; height: 20px; accent-color: #ff66b3; cursor: pointer; }
        .year-label { font-weight: bold; }
        .goals-list { margin-left: 30px; }
        .goal-item { display: flex; align-items: flex-start; margin: 8px 0; padding: 8px; border-radius: 8px; background: #fff; border: 1px solid #ffe6f2; }
        .goal-checkbox { margin-right: 10px; margin-top: 3px; width: 16px; height: 16px; accent-color: #ff66b3; cursor: pointer; }
        .goal-content { flex: 1; word-break: break-word; }
        .target-actions { margin-top: 10px; display: flex; gap: 10px; margin-left: 30px; }
        .target-edit-btn, .target-delete-btn { padding: 5px 10px; border: none; border-radius: 10px; cursor: pointer; transition: all 0.2s ease; font-size: 12px; display: inline-block; }
        .target-edit-btn { background: #ffb3d9; color: white; }
        .target-edit-btn:hover { background: #ff99cc; }
        .target-delete-btn { background: #ff6666; color: white; }
        .target-delete-btn:hover { background: #ff3333; }
        
        /* ÂºπÁ™óÊ†∑Âºè */
        .login-modal, .create-folder-modal, .exit-edit-modal, .target-modal, .folder-page-modal, .sticker-confirm-modal, .achievement-image-modal, .delete-sticker-modal, .media-preview-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 0 20px rgba(255, 102, 179, 0.3); z-index: 1000; width: 90%; max-width: 500px; }
        .delete-sticker-modal { max-width: 400px; }
        .achievement-image-modal { max-width: 700px; text-align: center; }
        .sticker-confirm-modal { max-width: 400px; }
        .folder-page-modal { max-width: 800px; width: 95%; max-height: 90vh; overflow-y: auto; }
        .media-preview-modal { max-width: 90vw; max-height: 90vh; width: auto; height: auto; padding: 0; background: transparent; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 153, 204, 0.5); z-index: 999; }
        .achievement-image { max-width: 100%; max-height: 70vh; border-radius: 15px; margin: 15px 0; }
        
        /* Â™í‰ΩìÈ¢ÑËßàÊ†∑Âºè */
        .media-preview-content { max-width: 100%; max-height: 80vh; display: flex; justify-content: center; align-items: center; }
        .media-preview-content img, .media-preview-content video { max-width: 100%; max-height: 80vh; border-radius: 10px; cursor: pointer; }
        .media-preview-controls { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; background: rgba(255, 255, 255, 0.9); padding: 10px 20px; border-radius: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .media-preview-btn { padding: 8px 16px; border: none; border-radius: 15px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; }
        .media-preview-close { background: #ff6666; color: white; }
        .media-preview-close:hover { background: #ff3333; }
        .media-preview-prev, .media-preview-next { background: #ff99cc; color: white; }
        .media-preview-prev:hover, .media-preview-next:hover { background: #ff66b3; }
        
        /* ÂêåÊ≠•Áä∂ÊÄÅÊåáÁ§∫Âô® */
        .sync-indicator { position: fixed; top: 20px; right: 20px; background: white; border-radius: 20px; padding: 8px 15px; box-shadow: 0 2px 10px rgba(255, 102, 179, 0.2); display: flex; align-items: center; gap: 8px; z-index: 1001; font-size: 14px; color: #5a2e48; }
        .sync-icon { width: 16px; height: 16px; border: 2px solid #ff66b3; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; }
        .sync-icon.synced { animation: none; border-color: #4CAF50; border-top-color: transparent; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* ÂºπÁ™óÊéß‰ª∂ */
        .login-modal input, .create-folder-modal input, .target-modal input, .target-modal textarea { margin: 0.5rem 0; padding: 10px 15px; width: 100%; border: 2px solid #ffb3d9; border-radius: 15px; outline: none; color: #5a2e48; }
        .target-modal textarea { min-height: 150px; resize: vertical; font-family: inherit; }
        .confirmBtn, .saveTargetBtn, .confirmCreateFolderBtn, .upload-media-btn, .confirmStickerBtn, .confirmAchievementBtn, .confirmDeleteStickerBtn { background: #ff66b3; color: white; border: none; border-radius: 15px; padding: 10px 20px; cursor: pointer; margin-right: 10px; transition: all 0.3s ease; }
        .cancelBtn, .cancelTargetBtn, .cancelCreateFolderBtn, .close-folder-page, .cancelStickerBtn, .cancelAchievementBtn, .cancelDeleteStickerBtn { background: #ffb3d9; color: white; border: none; border-radius: 15px; padding: 10px 20px; cursor: pointer; transition: all 0.3s ease; }
        .confirmBtn:hover, .saveTargetBtn:hover, .confirmCreateFolderBtn:hover, .upload-media-btn:hover, .confirmStickerBtn:hover, .confirmAchievementBtn:hover, .confirmDeleteStickerBtn:hover { background: #ff3399; transform: scale(1.05); }
        .cancelBtn:hover, .cancelTargetBtn:hover, .cancelCreateFolderBtn:hover, .close-folder-page:hover, .cancelStickerBtn:hover, .cancelAchievementBtn:hover, .cancelDeleteStickerBtn:hover { background: #ff99cc; transform: scale(1.05); }
        
        /* Êñá‰ª∂Â§πÂõæÊ†á‰∏ä‰º† */
        .folder-icon-upload { margin: 1rem 0; padding: 1rem; border: 2px dashed #ffb3d9; border-radius: 15px; text-align: center; cursor: pointer; }
        .folder-icon-upload:hover { border-color: #ff66b3; background: #fff0f7; }
        .icon-preview { width: 80px; height: 80px; margin: 1rem auto; border-radius: 10px; object-fit: contain; background: #fff8fc; display: flex; align-items: center; justify-content: center; color: #ff66b3; font-size: 30px; }
        
        /* È¶ñÈ°µÊ†∑Âºè */
        .home-page { display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 50px; padding: 20px; }
        .profile-card { background: white; border-radius: 30px; padding: 30px; box-shadow: 0 5px 15px rgba(255, 102, 179, 0.2); max-width: 400px; }
        .profile-card h1 { color: #ff66b3; font-size: 28px; margin-bottom: 20px; text-align: center; }
        .profile-info { margin: 15px 0; line-height: 1.8; }
        .profile-info span { font-weight: bold; color: #ff66b3; }
        .cartoon-img { width: 300px; height: 300px; border-radius: 50%; object-fit: cover; border: 5px solid #ff99cc; box-shadow: 0 5px 15px rgba(255, 102, 179, 0.3); cursor: pointer; transition: all 0.2s ease; }
        .cartoon-img:hover { transform: scale(1.02); box-shadow: 0 8px 20px rgba(255, 102, 179, 0.4); }
        
        /* È¶ñÈ°µÁºñËæë */
        .profile-edit-tools { display: none; margin-top: 15px; padding: 10px; background: #fff8fc; border-radius: 10px; border: 1px solid #ffd6e8; }
        .edit-tool-group { margin: 8px 0; display: flex; align-items: center; gap: 10px; }
        .edit-tool-label { font-size: 14px; color: #5a2e48; min-width: 80px; }
        .color-picker, .font-select { padding: 5px; border: 1px solid #ffb3d9; border-radius: 8px; background: white; color: #5a2e48; }
        
        /* Ë¥¥Á∫∏Ê†∑Âºè */
        .sticker-button { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; border-radius: 50%; background: #ff66b3; color: white; display: none; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; box-shadow: 0 4px 15px rgba(255, 102, 179, 0.3); z-index: 900; transition: all 0.3s ease; }
        .sticker-button:hover { background: #ff3399; transform: scale(1.1); }
        .sticker-toolbar { position: fixed; bottom: 100px; right: 30px; background: white; border-radius: 15px; padding: 10px; box-shadow: 0 4px 15px rgba(255, 102, 179, 0.3); z-index: 899; display: none; }
        .sticker-tool-btn { padding: 5px 10px; border: none; border-radius: 8px; cursor: pointer; margin: 5px; background: #ffb3d9; color: white; font-size: 12px; transition: all 0.2s ease; }
        .sticker-tool-btn:hover { background: #ff66b3; transform: scale(1.05); }
        .sticker-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 800; }
        .sticker-item { position: absolute; cursor: move; pointer-events: all; transform-origin: center center; transition: all 0.1s ease; border-radius: 8px; overflow: hidden; }
        .sticker-handle { position: absolute; bottom: 5px; right: 5px; width: 20px; height: 20px; background: #ff66b3; border-radius: 50%; cursor: nwse-resize; display: none; }
        .sticker-rotate-handle { display: none; }
        .sticker-rotate-tip { position: absolute; top: 5px; left: 5px; width: 20px; height: 20px; background: #ff99cc; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; cursor: grab; display: none; }
        .sticker-flip-handle { position: absolute; top: 5px; right: 5px; width: 20px; height: 20px; background: #ffb3d9; border-radius: 50%; cursor: pointer; display: none; }
        .sticker-delete-handle { position: absolute; top: 5px; right: 5px; width: 20px; height: 20px; background: #ff6666; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; cursor: pointer; display: none; }
        .sticker-item.editable .sticker-handle, 
        .sticker-item.editable .sticker-rotate-tip,
        .sticker-item.editable .sticker-flip-handle,
        .sticker-item.editable .sticker-delete-handle { display: flex; }
        .sticker-flip-menu { position: absolute; top: 30px; left: 5px; background: white; border-radius: 8px; padding: 5px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); z-index: 10; display: none; }
        .flip-option { padding: 3px 8px; font-size: 12px; cursor: pointer; border-radius: 4px; }
        .flip-option:hover { background: #ffe6f2; }
        
        /* ÂìçÂ∫îÂºè */
        @media (max-width: 768px) {
            .sidebar { width: 180px; }
            .main-content { margin-left: 180px; padding: 20px; }
            .media-section { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
            .home-page { flex-direction: column; text-align: center; }
            .cartoon-img { margin: 0 auto 2rem; }
            .sync-indicator { top: 10px; right: 10px; font-size: 12px; padding: 6px 12px; }
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 640px) {
            .sidebar { width: 150px; padding: 20px 10px; }
            .sidebar h2 { font-size: 18px; margin-bottom: 20px; }
            .sidebar-btn { padding: 10px 12px; font-size: 13px; }
            .main-content { margin-left: 150px; padding: 15px; }
            .page-title { font-size: 22px; margin-bottom: 20px; }
            .content-section { padding: 20px; }
            .section-title { font-size: 18px; }
            .media-section { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1rem; padding: 0.8rem; }
            .folder-item, .file-item { height: 140px; padding: 0.8rem; }
            .folder-icon, .file-icon { width: 60px; height: 60px; margin-bottom: 0.6rem; }
            .folder-name, .file-name { font-size: 12px; }
            .cartoon-img { width: 250px; height: 250px; }
            .profile-card { padding: 20px; max-width: 100%; }
            .profile-card h1 { font-size: 24px; }
            .login-modal, .create-folder-modal, .target-modal, .folder-page-modal, .sticker-confirm-modal, .achievement-image-modal, .delete-sticker-modal, .media-preview-modal { width: 95%; padding: 1.5rem; }
            .add-target-btn { position: static; margin-top: 10px; width: 100%; }
            .year-target-container { padding: 12px; }
            .year-header { font-size: 16px; }
            .goals-list { margin-left: 20px; }
            .goal-item { padding: 6px; }
            .target-actions { margin-left: 20px; }
            .sticker-button { bottom: 20px; right: 20px; width: 50px; height: 50px; font-size: 20px; }
            .sticker-toolbar { bottom: 80px; right: 20px; padding: 8px; }
            .sticker-tool-btn { padding: 4px 8px; font-size: 11px; margin: 3px; }
            .media-preview-controls { flex-wrap: wrap; justify-content: center; bottom: 10px; }
            .media-preview-btn { padding: 6px 12px; font-size: 12px; }
        }
        
        /* Ë∂ÖÂ∞èÂ±èÂπï‰ºòÂåñ */
        @media (max-width: 480px) {
            .sidebar { width: 130px; }
            .sidebar h2 { font-size: 16px; }
            .sidebar-btn { padding: 8px 10px; font-size: 12px; }
            .main-content { margin-left: 130px; padding: 10px; }
            .media-section { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
            .folder-item, .file-item { height: 120px; padding: 0.6rem; }
            .folder-icon, .file-icon { width: 50px; height: 50px; }
            .cartoon-img { width: 200px; height: 200px; }
        }
    </style>
</head>
<body>
    <!-- ÂêåÊ≠•Áä∂ÊÄÅÊåáÁ§∫Âô® -->
    <div class="sync-indicator" id="syncIndicator">
        <div class="sync-icon" id="syncIcon"></div>
        <span id="syncStatus">Syncing...</span>
    </div>

    <!-- ‰æßËæπÊ†è -->
    <div class="sidebar">
        <h2>Yomi's World</h2>
        <div class="login-section">
            <button class="login-btn" id="loginBtn">Management Login</button>
        </div>
        <button class="sidebar-btn" onclick="navigateTo('home')">üè† Home</button>
        <button class="sidebar-btn" onclick="navigateTo('study')">üìö Study Diary</button>
        <button class="sidebar-btn" onclick="navigateTo('vlog')">üé• Daily Vlog</button>
        <button class="sidebar-btn" onclick="navigateTo('week')">üìñ Week Diary</button>
        <button class="sidebar-btn" onclick="navigateTo('achieve')">üèÜ Achievements</button>
        <button class="sidebar-btn" onclick="navigateTo('target')">üéØ Personal Target</button>
    </div>

    <!-- ÂºπÁ™óÂå∫Âüü -->
    <div class="overlay" id="loginOverlay"></div>
    <div class="login-modal" id="loginModal">
        <h3 style="color: #ff66b3; text-align: center; margin-bottom: 1rem;">Management Login</h3>
        <input type="password" id="passwordInput" placeholder="Enter password">
        <button id="submitLogin" style="width: 100%; background: #ff66b3; color: white; border: none; border-radius: 15px; padding: 10px; cursor: pointer; margin-top: 1rem;">Login</button>
        <p id="loginError" style="color: #ff6666; margin-top: 0.5rem; display: none; text-align: center;">Wrong password!</p>
    </div>

    <div class="overlay" id="exitEditOverlay"></div>
    <div class="exit-edit-modal" id="exitEditModal">
        <h3 style="color: #ff66b3; text-align: center; margin-bottom: 1rem;">Exit Edit Mode?</h3>
        <p style="text-align: center; margin-bottom: 1rem; color: #5a2e48;">Are you sure you want to end edit mode?</p>
        <div style="display: flex; justify-content: center; gap: 10px;">
            <button id="confirmExitEdit" class="confirmBtn">Yes</button>
            <button id="cancelExitEdit" class="cancelBtn">No</button>
        </div>
    </div>

    <div class="overlay" id="stickerConfirmOverlay"></div>
    <div class="sticker-confirm-modal" id="stickerConfirmModal">
        <h3 style="color: #ff66b3; text-align: center; margin-bottom: 1rem;">Finish Sticker Editing?</h3>
        <p style="text-align: center; margin-bottom: 1rem; color: #5a2e48;">Are you sure you want to save the sticker changes?</p>
        <div style="display: flex; justify-content: center; gap: 10px;">
            <button id="confirmStickerBtn" class="confirmStickerBtn">Yes</button>
            <button id="cancelStickerBtn" class="cancelStickerBtn">No</button>
        </div>
    </div>

    <div class="overlay" id="deleteStickerOverlay"></div>
    <div class="delete-sticker-modal" id="deleteStickerModal">
        <h3 style="color: #ff66b3; text-align: center; margin-bottom: 1rem;">Delete Sticker?</h3>
        <p style="text-align: center; margin-bottom: 1rem; color: #5a2e48;">Are you sure you want to delete this sticker?</p>
        <div style="display: flex; justify-content: center; gap: 10px;">
            <button id="confirmDeleteStickerBtn" class="confirmDeleteStickerBtn">Yes</button>
            <button id="cancelDeleteStickerBtn" class="cancelDeleteStickerBtn">No</button>
        </div>
    </div>

    <div class="overlay" id="achievementImageOverlay"></div>
    <div class="achievement-image-modal" id="achievementImageModal">
        <h3 style="color: #ff66b3; text-align: center; margin-bottom: 1rem;">üéâ Congratulations! üéâ</h3>
        <p style="text-align: center; margin-bottom: 1rem; color: #5a2e48;">You've completed all your goals for this year!</p>
        <img id="achievementImage" class="achievement-image" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1' height='1'%3E%3C/svg%3E" alt="Achievement">
        <div style="display: flex; justify-content: center; gap: 10px; margin-top: 1rem;">
            <button id="confirmAchievementBtn" class="confirmAchievementBtn">OK</button>
        </div>
    </div>

    <!-- Êñ∞Â¢ûÔºöÂ™í‰ΩìÈ¢ÑËßàÂºπÁ™ó -->
    <div class="overlay" id="mediaPreviewOverlay"></div>
    <div class="media-preview-modal" id="mediaPreviewModal">
        <div class="media-preview-content" id="mediaPreviewContent">
            <!-- Â™í‰ΩìÂÜÖÂÆπÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÂä†ËΩΩ -->
        </div>
        <div class="media-preview-controls">
            <button class="media-preview-btn media-preview-prev" id="mediaPreviewPrev">‚Üê Previous</button>
            <button class="media-preview-btn media-preview-close" id="mediaPreviewClose">Close</button>
            <button class="media-preview-btn media-preview-next" id="mediaPreviewNext">Next ‚Üí</button>
        </div>
    </div>

    <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
    <div class="main-content" id="main-content">
        <!-- ÊØè‰∏™È°µÈù¢Áã¨Á´ãÁöÑË¥¥Á∫∏ÂÆπÂô® -->
        <div id="home" class="page-content">
            <div class="sticker-container" id="stickerContainer_home"></div>
            <div class="home-page">
                <img src="https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/eff44eee1e6e4f2792c1775615dc2c74.JPG~tplv-a9rns2rl98-24:720:720.image?lk3s=8e244e95&rcl=202602080916150F3B363E9BA71B184F7A&rrcfp=8a172a1a&x-expires=1771118176&x-signature=rbjW80X3iJyV3cv9f5kR3omsSlc%3D" alt="Yomi's Profile" class="cartoon-img" id="profileImage">
                <div class="profile-card">
                    <h1>About Me üíñ</h1>
                    <div class="profile-edit-tools" id="profileEditTools">
                        <div class="edit-tool-group">
                            <span class="edit-tool-label">Text Color:</span>
                            <input type="color" class="color-picker" id="profileTextColor" value="#5a2e48">
                        </div>
                        <div class="edit-tool-group">
                            <span class="edit-tool-label">Font:</span>
                            <select class="font-select" id="profileFont">
                                <option value="Comic Sans MS, Arial Rounded MT Bold, sans-serif">Cute Font</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="Georgia, serif">Georgia</option>
                                <option value="Times New Roman, serif">Times New Roman</option>
                                <option value="Courier New, monospace">Courier</option>
                            </select>
                        </div>
                    </div>
                    <div class="profile-info" id="profileInfo" contenteditable="false" style="cursor: default;">
                        <p><span>Name:</span> Yomi Qiu</p>
                        <p><span>Birthday:</span> 2010.03.25</p>
                        <p><span>MBTI:</span> INTJ</p>
                        <p><span>Hobbies:</span> Playing Tennis, Finding Delicious Food, Mediating</p>
                        <p><span>Self-introduction:</span> Hello! I'm Yomi, born on March 25, 2010. As an INTJ, I'm a thoughtful and independent person who loves to explore the world around me. I enjoy reading, creating art, and documenting my daily life through diaries and vlogs. This little corner of the internet is where I share my study journey, daily life, and personal goals. Welcome to my world!</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÂêÑ‰∏™ÂäüËÉΩÈ°µÈù¢ -->
        <div id="study" class="page-content" style="display: none;">
            <div class="sticker-container" id="stickerContainer_study"></div>
            <h2 class="page-title">üìö Study Diary</h2>
            <section class="content-section">
                <h3 class="section-title">My Study Records</h3>
                <button class="add-folder-btn" id="studyAddFolderBtn" style="display: none;">+ Create New Folder</button>
                <div class="media-section" id="studyMedia"></div>
            </section>
        </div>

        <div id="vlog" class="page-content" style="display: none;">
            <div class="sticker-container" id="stickerContainer_vlog"></div>
            <h2 class="page-title">üé• Daily Vlog</h2>
            <section class="content-section">
                <h3 class="section-title">My Daily Life</h3>
                <button class="add-folder-btn" id="vlogAddFolderBtn" style="display: none;">+ Create New Folder</button>
                <div class="media-section" id="vlogMedia"></div>
            </section>
        </div>

        <div id="week" class="page-content" style="display: none;">
            <div class="sticker-container" id="stickerContainer_week"></div>
            <h2 class="page-title">üìñ Week Diary</h2>
            <section class="content-section">
                <h3 class="section-title">Weekly Reflections</h3>
                <button class="add-folder-btn" id="weekAddFolderBtn" style="display: none;">+ Create New Folder</button>
                <div class="media-section" id="weekMedia"></div>
            </section>
        </div>

        <div id="achieve" class="page-content" style="display: none;">
            <div class="sticker-container" id="stickerContainer_achieve"></div>
            <h2 class="page-title">üèÜ Achievements Showcase</h2>
            <section class="content-section">
                <h3 class="section-title">My Accomplishments</h3>
                <button class="add-folder-btn" id="achieveAddFolderBtn" style="display: none;">+ Create New Folder</button>
                <div class="media-section" id="achieveMedia"></div>
            </section>
        </div>

        <div id="target" class="page-content" style="display: none;">
            <div class="sticker-container" id="stickerContainer_target"></div>
            <h2 class="page-title">üéØ Personal Target</h2>
            <section class="content-section personal-target">
                <h3 class="section-title">My Goals & Dreams</h3>
                <button class="add-target-btn" id="addTargetBtn" style="display: none;">+ Add Target</button>
                <div class="target-list" id="targetList"></div>
            </section>
        </div>
    </div>

    <!-- ÂäüËÉΩÂºπÁ™ó -->
    <div class="overlay" id="createFolderOverlay"></div>
    <div class="create-folder-modal" id="createFolderModal">
        <h3 style="color: #ff66b3; text-align: center; margin-bottom: 1rem;">Create New Folder</h3>
        <input type="text" id="newFolderNameInput" placeholder="Enter folder name (e.g. Math Homework)">
        <div class="folder-icon-upload" id="folderIconUpload">
            <p style="color: #ff66b3;">üìÅ Click to upload folder icon</p>
            <div class="icon-preview" id="folderIconPreview">üìÅ</div>
            <input type="file" id="folderIconFileInput" accept="image/*" style="display: none;">
        </div>
        <div style="display: flex; justify-content: center; gap: 10px; margin-top: 1rem;">
            <button id="confirmCreateFolderBtn" class="confirmCreateFolderBtn">Create</button>
            <button id="cancelCreateFolderBtn" class="cancelCreateFolderBtn">Cancel</button>
        </div>
    </div>

    <div class="overlay" id="folderPageOverlay"></div>
    <div class="folder-page-modal" id="folderPageModal">
        <h3 style="color: #ff66b3; text-align: center; margin-bottom: 1rem;" id="folderPageTitle">Folder Content</h3>
        <button class="upload-media-btn" id="uploadMediaBtn">+ Upload Photo/Video</button>
        <div class="media-section" id="folderMediaContent"></div>
        <div style="display: flex; justify-content: center; gap: 10px; margin-top: 1rem;">
            <button id="closeFolderPageBtn" class="close-folder-page">Close</button>
        </div>
    </div>

    <div class="overlay" id="targetOverlay"></div>
    <div class="target-modal" id="targetModal">
        <h3 style="color: #ff66b3; text-align: center; margin-bottom: 1rem;">Add/Edit Target</h3>
        <div class="target-form">
            <input type="text" id="targetYear" placeholder="Enter year (e.g. 2024)">
            <textarea id="targetContent" placeholder="Enter targets (one per line)&#10;e.g.&#10;Learn JavaScript&#10;Read 10 books&#10;Exercise 3 times a week"></textarea>
            <input type="hidden" id="targetId">
            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 1rem;">
                <button id="saveTargetBtn" class="saveTargetBtn">Save</button>
                <button id="cancelTargetBtn" class="cancelTargetBtn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Ë¥¥Á∫∏ÊåâÈíÆÂíåÂ∑•ÂÖ∑Ê†è -->
    <div class="sticker-button" id="stickerButton">üç™</div>
    <div class="sticker-toolbar" id="stickerToolbar">
        <button class="sticker-tool-btn" id="addNewStickerBtn">‚ûï Add Sticker</button>
        <button class="sticker-tool-btn" id="flipHorizontalBtn">‚ÜîÔ∏è Horizontal</button>
        <button class="sticker-tool-btn" id="flipVerticalBtn">‚ÜïÔ∏è Vertical</button>
    </div>

    <script>
        // Ê†∏ÂøÉÂèòÈáè
        const PWD = "Shining0325!";
        let isAdmin = false, currMedia = "", currFolder = "", editTargetId = null, stickerEdit = false;
        let folderIcons = {}, folderNames = {}, folderContents = {}, targets = [];
        let idCounter = 1;
        let currentDeleteSticker = null;
        let selectedSticker = null;
        let currentPageId = 'home';
        let pageStickers = {
            home: [],
            study: [],
            vlog: [],
            week: [],
            achieve: [],
            target: []
        };
        let profileData = {
            image: "",
            info: "",
            textColor: "#5a2e48",
            font: "Comic Sans MS, Arial Rounded MT Bold, sans-serif"
        };
        
        // Êñ∞Â¢ûÔºöÂ™í‰ΩìÈ¢ÑËßàÁõ∏ÂÖ≥ÂèòÈáè
        let currentMediaFolder = null;
        let currentMediaIndex = -1;
        
        // Êñ∞Â¢ûÔºöÊï∞ÊçÆÂêåÊ≠•Áõ∏ÂÖ≥ÂèòÈáè
        let syncInterval = null;
        let lastSyncTime = 0;
        let syncTimeout = null;
        const SYNC_INTERVAL = 30000; // 30ÁßíËá™Âä®ÂêåÊ≠•
        const SYNC_DELAY = 2000; // Êï∞ÊçÆÂèòÊõ¥ÂêéÂª∂Ëøü2ÁßíÂêåÊ≠•
        
        // ÊóãËΩ¨Áä∂ÊÄÅÂèòÈáè
        let isRotating = false;
        let rotateStartX, rotateStartY, rotateStartAngle = 0;
        let rotateSticker = null;

        // ÊøÄÂä±ËØ≠
        const quotes = [
            "Believe in yourself, you did it! ‚ú®", "Hard work pays off, congratulations! üéâ",
            "You're amazing, keep going! üí™", "Dream big, achieve bigger! üåü",
            "Success is the sum of small efforts! üìö", "You've crushed your goals, proud of you! ü•≥",
            "Every small step leads to big achievements! üöÄ", "Consistency is key, and you nailed it! üóùÔ∏è"
        ];

        // ========== Êï∞ÊçÆÂêåÊ≠•ÂäüËÉΩ ==========
        // Êõ¥Êñ∞ÂêåÊ≠•Áä∂ÊÄÅÊåáÁ§∫Âô®
        function updateSyncStatus(status, message = "") {
            const syncIcon = document.getElementById('syncIcon');
            const syncStatus = document.getElementById('syncStatus');
            
            syncIcon.className = 'sync-icon';
            switch(status) {
                case 'syncing':
                    syncIcon.classList.add('syncing');
                    syncStatus.textContent = message || 'Syncing...';
                    break;
                case 'synced':
                    syncIcon.classList.add('synced');
                    syncStatus.textContent = message || 'Synced';
                    break;
                case 'pending':
                    syncStatus.textContent = message || 'Pending sync...';
                    break;
            }
        }

        // ‰øùÂ≠òÊï∞ÊçÆÂà∞ËøúÁ®ãÂ≠òÂÇ®ÔºàÊ®°ÊãüÔºâ
        async function saveDataToRemote() {
            updateSyncStatus('syncing');
            
            try {
                // ÂáÜÂ§áË¶ÅÂêåÊ≠•ÁöÑÊï∞ÊçÆ
                const syncData = {
                    folderIcons,
                    folderNames,
                    folderContents,
                    targets,
                    idCounter,
                    pageStickers,
                    profileData,
                    timestamp: Date.now(),
                    version: '1.0'
                };
                
                // Ê®°ÊãüÁΩëÁªúËØ∑Ê±ÇÂª∂Ëøü
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáå‰ºöÂèëÈÄÅÊï∞ÊçÆÂà∞ÊúçÂä°Âô®
                // Áé∞Âú®Êàë‰ª¨‰ΩøÁî®localStorage‰Ωú‰∏∫Ê®°ÊãüÁöÑËøúÁ®ãÂ≠òÂÇ®
                localStorage.setItem('yomisWorldRemoteData', JSON.stringify(syncData));
                
                lastSyncTime = Date.now();
                updateSyncStatus('synced', 'Synced');
                
                // 3ÁßíÂêéÈöêËóèÂêåÊ≠•ÊàêÂäüÁä∂ÊÄÅ
                setTimeout(() => {
                    updateSyncStatus('synced', '');
                }, 3000);
                
                return true;
            } catch (error) {
                console.error('ÂêåÊ≠•Â§±Ë¥•:', error);
                updateSyncStatus('synced', 'Synced');
                return false;
            }
        }

        // ‰ªéËøúÁ®ãÂ≠òÂÇ®Âä†ËΩΩÊï∞ÊçÆÔºàÊ®°ÊãüÔºâ
        async function loadDataFromRemote() {
            updateSyncStatus('syncing', 'Loading data...');
            
            try {
                // Ê®°ÊãüÁΩëÁªúËØ∑Ê±ÇÂª∂Ëøü
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáå‰ºö‰ªéÊúçÂä°Âô®Ëé∑ÂèñÊï∞ÊçÆ
                // Áé∞Âú®Êàë‰ª¨‰ΩøÁî®localStorage‰Ωú‰∏∫Ê®°ÊãüÁöÑËøúÁ®ãÂ≠òÂÇ®
                const remoteDataStr = localStorage.getItem('yomisWorldRemoteData');
                
                if (remoteDataStr) {
                    const remoteData = JSON.parse(remoteDataStr);
                    
                    // Ê£ÄÊü•Êï∞ÊçÆÁâàÊú¨ÂíåÊó∂Èó¥Êà≥
                    if (remoteData.version && remoteData.timestamp) {
                        const localDataStr = localStorage.getItem('yomisWorldData');
                        const localData = localDataStr ? JSON.parse(localDataStr) : null;
                        const localTimestamp = localData?.timestamp || 0;
                        
                        // Â¶ÇÊûúËøúÁ®ãÊï∞ÊçÆÊõ¥Êñ∞ÔºåÂàô‰ΩøÁî®ËøúÁ®ãÊï∞ÊçÆ
                        if (remoteData.timestamp > localTimestamp) {
                            folderIcons = remoteData.folderIcons || {};
                            folderNames = remoteData.folderNames || {};
                            folderContents = remoteData.folderContents || {};
                            targets = remoteData.targets || [];
                            idCounter = remoteData.idCounter || 1;
                            pageStickers = remoteData.pageStickers || {
                                home: [],
                                study: [],
                                vlog: [],
                                week: [],
                                achieve: [],
                                target: []
                            };
                            profileData = remoteData.profileData || {
                                image: "",
                                info: "",
                                textColor: "#5a2e48",
                                font: "Comic Sans MS, Arial Rounded MT Bold, sans-serif"
                            };
                            
                            // ÂêåÊó∂Êõ¥Êñ∞Êú¨Âú∞Â≠òÂÇ®
                            saveAllData();
                            
                            updateSyncStatus('synced', 'Updated from cloud');
                            return true;
                        }
                    }
                }
            } catch (error) {
                console.error('Âä†ËΩΩËøúÁ®ãÊï∞ÊçÆÂ§±Ë¥•:', error);
                updateSyncStatus('synced', 'Up to date');
            }
            
            updateSyncStatus('synced', 'Up to date');
            return false;
        }

        // ÂêØÂä®Ëá™Âä®ÂêåÊ≠•
        function startAutoSync() {
            // Á´ãÂç≥ËøõË°å‰∏ÄÊ¨°ÂêåÊ≠•
            syncData();
            
            // ËÆæÁΩÆÂÆöÊúüÂêåÊ≠•
            syncInterval = setInterval(() => {
                syncData();
            }, SYNC_INTERVAL);
        }

        // ÂÅúÊ≠¢Ëá™Âä®ÂêåÊ≠•
        function stopAutoSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
                syncInterval = null;
            }
            if (syncTimeout) {
                clearTimeout(syncTimeout);
                syncTimeout = null;
            }
        }

        // ÂêåÊ≠•Êï∞ÊçÆ
        function syncData() {
            // ÂÖàÂ∞ùËØï‰ªéËøúÁ®ãÂä†ËΩΩÊúÄÊñ∞Êï∞ÊçÆ
            loadDataFromRemote().then(hasNewData => {
                // Â¶ÇÊûúÊ≤°ÊúâÊñ∞Êï∞ÊçÆÊàñÂä†ËΩΩÂ§±Ë¥•ÔºåÂàô‰øùÂ≠òÊú¨Âú∞Êï∞ÊçÆÂà∞ËøúÁ®ã
                if (!hasNewData) {
                    saveDataToRemote();
                }
            });
        }

        // Âª∂ËøüÂêåÊ≠•ÔºàÁî®‰∫éÊï∞ÊçÆÂèòÊõ¥ÂêéÔºâ
        function delayedSync() {
            if (syncTimeout) {
                clearTimeout(syncTimeout);
            }
            
            updateSyncStatus('pending');
            
            syncTimeout = setTimeout(() => {
                syncData();
            }, SYNC_DELAY);
        }

        // ========== Êú¨Âú∞Â≠òÂÇ®ÂäüËÉΩ ==========
        // ‰øùÂ≠òÊâÄÊúâÊï∞ÊçÆÂà∞localStorage
        function saveAllData() {
            const data = {
                folderIcons,
                folderNames,
                folderContents,
                targets,
                idCounter,
                pageStickers,
                profileData,
                timestamp: Date.now(),
                version: '1.0'
            };
            localStorage.setItem('yomisWorldData', JSON.stringify(data));
            
            // Êï∞ÊçÆÂèòÊõ¥ÂêéËß¶ÂèëÂª∂ËøüÂêåÊ≠•
            delayedSync();
        }

        // ‰ªélocalStorageÂä†ËΩΩÊâÄÊúâÊï∞ÊçÆ
        function loadAllData() {
            const savedData = localStorage.getItem('yomisWorldData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    folderIcons = data.folderIcons || {};
                    folderNames = data.folderNames || {};
                    folderContents = data.folderContents || {};
                    targets = data.targets || [];
                    idCounter = data.idCounter || 1;
                    pageStickers = data.pageStickers || {
                        home: [],
                        study: [],
                        vlog: [],
                        week: [],
                        achieve: [],
                        target: []
                    };
                    profileData = data.profileData || {
                        image: "",
                        info: "",
                        textColor: "#5a2e48",
                        font: "Comic Sans MS, Arial Rounded MT Bold, sans-serif"
                    };
                    
                    // Êï∞ÊçÆËøÅÁßªÔºöÂ∞ÜÊóßÊ†ºÂºèÁöÑÊñá‰ª∂Â§πÂÜÖÂÆπËΩ¨Êç¢‰∏∫Êñ∞Ê†ºÂºè
                    Object.keys(folderContents).forEach(folderId => {
                        const content = folderContents[folderId];
                        if (Array.isArray(content)) {
                            folderContents[folderId] = {
                                section: "study",
                                files: content
                            };
                        }
                    });
                    
                    // Ê∏ÖÁêÜÊó†ÊïàÁöÑË¥¥Á∫∏Êï∞ÊçÆ
                    Object.keys(pageStickers).forEach(pageId => {
                        pageStickers[pageId] = pageStickers[pageId].filter(sticker => {
                            return sticker && sticker.url && sticker.url.trim() !== "";
                        });
                    });
                } catch (e) {
                    console.error('Âä†ËΩΩÊú¨Âú∞Êï∞ÊçÆÂ§±Ë¥•:', e);
                    // ÈáçÁΩÆÊâÄÊúâÊï∞ÊçÆ
                    folderIcons = {};
                    folderNames = {};
                    folderContents = {};
                    targets = [];
                    idCounter = 1;
                    pageStickers = {
                        home: [],
                        study: [],
                        vlog: [],
                        week: [],
                        achieve: [],
                        target: []
                    };
                    profileData = {
                        image: "",
                        info: "",
                        textColor: "#5a2e48",
                        font: "Comic Sans MS, Arial Rounded MT Bold, sans-serif"
                    };
                }
            }
        }

        // Á°Æ‰øùË¥¥Á∫∏ÂÆπÂô®Ê≠£Á°ÆÊòæÁ§∫
        function ensureStickerContainers() {
            const pages = ['home', 'study', 'vlog', 'week', 'achieve', 'target'];
            pages.forEach(pageId => {
                const container = document.getElementById(`stickerContainer_${pageId}`);
                if (container) {
                    container.style.position = 'absolute';
                    container.style.top = '0';
                    container.style.left = '0';
                    container.style.width = '100%';
                    container.style.height = '100%';
                    container.style.pointerEvents = 'none';
                    container.style.zIndex = '800';
                }
            });
        }

        // Ê∏≤ÊüìÊâÄÊúâ‰øùÂ≠òÁöÑÊñá‰ª∂Â§π
        function renderAllFolders() {
            const sections = ['study', 'vlog', 'week', 'achieve'];
            
            sections.forEach(section => {
                const mediaContainer = el(`${section}Media`);
                mediaContainer.innerHTML = "";
                
                const folderIds = Object.keys(folderNames).filter(folderId => {
                    return folderContents[folderId] && folderContents[folderId].section === section;
                });
                
                folderIds.forEach(folderId => {
                    const folder = document.createElement("div");
                    folder.className = "folder-item";
                    folder.dataset.id = folderId;
                    folder.innerHTML = `
                        <button class="delete-folder" style="display: ${isAdmin ? 'flex' : 'none'}">√ó</button>
                        <img src="${folderIcons[folderId] || 'https://via.placeholder.com/70/ff66b3/ffffff?text=üìÅ'}" class="folder-icon" alt="${folderNames[folderId]}">
                        <div class="folder-name" contenteditable="${isAdmin}">${folderNames[folderId] || 'New Folder'}</div>
                    `;

                    // ÂêçÁß∞ÁºñËæë
                    const nameEl = folder.querySelector('.folder-name');
                    nameEl.addEventListener("keydown", (e) => {
                        if (!isAdmin) return;
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            nameEl.blur();
                        }
                    });

                    nameEl.addEventListener("blur", () => {
                        if (!isAdmin) return;
                        const newName = nameEl.textContent.trim() || "New Folder";
                        nameEl.textContent = newName;
                        folderNames[folderId] = newName;
                        saveAllData();
                    });

                    // Âà†Èô§Êñá‰ª∂Â§π
                    folder.querySelector(".delete-folder").addEventListener("click", (e) => {
                        e.stopPropagation();
                        if (!isAdmin) return;
                        if (confirm(`Are you sure to delete the folder "${nameEl.textContent}"?\nAll contents inside will also be deleted.`)) {
                            if (folderContents[folderId] && folderContents[folderId].files) {
                                folderContents[folderId].files.forEach(file => {
                                    if (file.url && file.url.startsWith('blob:')) URL.revokeObjectURL(file.url);
                                });
                            }
                            mediaContainer.removeChild(folder);
                            delete folderIcons[folderId];
                            delete folderNames[folderId];
                            delete folderContents[folderId];
                            saveAllData();
                        }
                    });

                    // ÊâìÂºÄÊñá‰ª∂Â§π
                    folder.addEventListener("click", (e) => {
                        if (e.target.classList.contains('delete-folder') || e.target.classList.contains('folder-name')) return;
                        openFolder(folderId);
                    });

                    mediaContainer.appendChild(folder);
                });
            });
        }

        // Ê∏≤Êüì‰∏™‰∫∫ËµÑÊñô
        function renderProfileData() {
            if (profileData.image) {
                el('profileImage').src = profileData.image;
            }
            
            if (profileData.info) {
                el('profileInfo').innerHTML = profileData.info;
            }
            
            el('profileInfo').style.color = profileData.textColor || "#5a2e48";
            el('profileInfo').style.fontFamily = profileData.font || "Comic Sans MS, Arial Rounded MT Bold, sans-serif";
            el('profileTextColor').value = profileData.textColor || "#5a2e48";
            el('profileFont').value = profileData.font || "Comic Sans MS, Arial Rounded MT Bold, sans-serif";
            
            el('profileInfo').addEventListener('input', () => {
                if (isAdmin) {
                    profileData.info = el('profileInfo').innerHTML;
                    saveAllData();
                }
            });
            
            el('profileTextColor').addEventListener("input", () => {
                if (isAdmin) {
                    profileData.textColor = el('profileTextColor').value;
                    el("profileInfo").style.color = profileData.textColor;
                    saveAllData();
                }
            });

            el('profileFont').addEventListener("change", () => {
                if (isAdmin) {
                    profileData.font = el('profileFont').value;
                    el("profileInfo").style.fontFamily = profileData.font;
                    saveAllData();
                }
            });
            
            el('profileImage').addEventListener("click", () => {
                if (!isAdmin) return;
                
                const input = document.createElement("input");
                input.type = "file";
                input.accept = "image/*";
                input.click();
                
                input.addEventListener("change", (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (ev) => {
                            el("profileImage").src = ev.target.result;
                            profileData.image = ev.target.result;
                            saveAllData();
                            alert("Profile image updated successfully!");
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });
        }

        // È°µÈù¢ÂØºËà™
        function navigateTo(pageId) {
            if (stickerEdit) {
                finishSticker(true);
            }
            
            document.querySelectorAll('.page-content').forEach(p => p.style.display = 'none');
            document.getElementById(pageId).style.display = 'block';
            currentPageId = pageId;
            
            if (isAdmin) {
                document.getElementById('stickerButton').style.display = 'flex';
            } else {
                document.getElementById('stickerButton').style.display = 'none';
            }
            
            ensureStickerContainers();
            loadPageStickers(pageId);
        }

        // DOMÂÖÉÁ¥†Ëé∑Âèñ
        const el = (id) => document.getElementById(id);
        const els = (cls) => document.querySelectorAll(cls);
        
        // ÁôªÂΩï/ÈÄÄÂá∫ÈÄªËæë
        el("loginBtn").addEventListener("click", () => {
            if (!isAdmin) {
                el("loginModal").style.display = "block";
                el("loginOverlay").style.display = "block";
                el("passwordInput").focus();
            } else {
                el("exitEditModal").style.display = "block";
                el("exitEditOverlay").style.display = "block";
            }
        });

        // Á°ÆËÆ§ÈÄÄÂá∫ÁºñËæë
        el("confirmExitEdit").addEventListener("click", () => {
            isAdmin = false;
            el("exitEditModal").style.display = el("exitEditOverlay").style.display = "none";
            
            els(".add-folder-btn, .add-target-btn, .sticker-button, .profile-edit-tools").forEach(e => e.style.display = "none");
            els(".delete-folder, .delete-file, .target-edit-btn, .target-delete-btn").forEach(e => e.style.display = "none");
            
            el("profileInfo").contentEditable = false;
            el("profileInfo").style.cursor = "default";
            
            els('.folder-name, .file-name').forEach(el => {
                el.contentEditable = false;
                el.style.cursor = "default";
            });
            
            if (stickerEdit) finishSticker(true);
            
            saveAllData();
            
            // ÊòæÁ§∫ÂêåÊ≠•ÂÆåÊàêÁä∂ÊÄÅ
            updateSyncStatus('synced', 'All changes synced');
            setTimeout(() => {
                updateSyncStatus('synced', '');
            }, 3000);
        });

        // ÂèñÊ∂àÈÄÄÂá∫
        el("cancelExitEdit").addEventListener("click", () => {
            el("exitEditModal").style.display = el("exitEditOverlay").style.display = "none";
        });

        // ÁôªÂΩïÈ™åËØÅ
        el("submitLogin").addEventListener("click", () => {
            if (el("passwordInput").value === PWD) {
                isAdmin = true;
                el("loginModal").style.display = el("loginOverlay").style.display = "none";
                
                els(".add-folder-btn").forEach(e => e.style.display = "inline-block");
                el("addTargetBtn").style.display = "inline-block";
                el("stickerButton").style.display = "flex";
                el("profileEditTools").style.display = "block";
                
                el("profileInfo").contentEditable = true;
                el("profileInfo").style.cursor = "text";
                els(".delete-folder, .delete-file").forEach(e => e.style.display = "flex");
                els(".target-edit-btn, .target-delete-btn").forEach(e => e.style.display = "inline-block");
                
                els('.folder-name, .file-name').forEach(el => {
                    el.contentEditable = true;
                    el.style.cursor = "text";
                });
                
                loadPageStickers(currentPageId);
                
                alert("‚ú® Edit mode begin! You can now create folders and manage content.");
            } else {
                el("loginError").style.display = "block";
                el("passwordInput").value = "";
            }
        });

        // ÂÖ≥Èó≠ÂºπÁ™óÈÄöÁî®ÊñπÊ≥ï
        function closeModal(modalId, overlayId) {
            el(modalId).style.display = el(overlayId).style.display = "none";
        }

        // ÁªëÂÆöÂºπÁ™óÂÖ≥Èó≠‰∫ã‰ª∂
        el("loginOverlay").addEventListener("click", () => closeModal("loginModal", "loginOverlay"));
        el("exitEditOverlay").addEventListener("click", () => closeModal("exitEditModal", "exitEditOverlay"));
        el("cancelCreateFolderBtn").addEventListener("click", () => closeModal("createFolderModal", "createFolderOverlay"));
        el("createFolderOverlay").addEventListener("click", () => closeModal("createFolderModal", "createFolderOverlay"));
        el("closeFolderPageBtn").addEventListener("click", () => {
            closeModal("folderPageModal", "folderPageOverlay");
            currFolder = "";
        });
        el("folderPageOverlay").addEventListener("click", () => {
            closeModal("folderPageModal", "folderPageOverlay");
            currFolder = "";
        });
        el("cancelTargetBtn").addEventListener("click", () => {
            closeModal("targetModal", "targetOverlay");
            editTargetId = null;
        });
        el("targetOverlay").addEventListener("click", () => {
            closeModal("targetModal", "targetOverlay");
            editTargetId = null;
        });

        el("deleteStickerOverlay").addEventListener("click", () => closeModal("deleteStickerModal", "deleteStickerOverlay"));
        el("cancelDeleteStickerBtn").addEventListener("click", () => {
            closeModal("deleteStickerModal", "deleteStickerOverlay");
            currentDeleteSticker = null;
        });
        el("confirmDeleteStickerBtn").addEventListener("click", () => {
            if (currentDeleteSticker) {
                const stickerId = currentDeleteSticker.dataset.stickerId;
                pageStickers[currentPageId] = pageStickers[currentPageId].filter(s => s.id !== stickerId);
                currentDeleteSticker.remove();
                currentDeleteSticker = null;
                saveAllData();
            }
            closeModal("deleteStickerModal", "deleteStickerOverlay");
        });

        // Êñ∞Â¢ûÔºöÂ™í‰ΩìÈ¢ÑËßàÂºπÁ™óÂÖ≥Èó≠‰∫ã‰ª∂
        el("mediaPreviewOverlay").addEventListener("click", () => closeModal("mediaPreviewModal", "mediaPreviewOverlay"));
        el("mediaPreviewClose").addEventListener("click", () => closeModal("mediaPreviewModal", "mediaPreviewOverlay"));

        // ÊâìÂºÄÂàõÂª∫Êñá‰ª∂Â§πÂºπÁ™ó
        function openCreateFolder(section) {
            if (!isAdmin) return;
            currMedia = section;
            el("createFolderModal").style.display = "block";
            el("createFolderOverlay").style.display = "block";
            el("newFolderNameInput").value = "";
            el("folderIconPreview").innerHTML = "üìÅ";
            el("folderIconFileInput").value = "";
            setTimeout(() => el("newFolderNameInput").focus(), 100);
        }

        // Êñá‰ª∂Â§πÂõæÊ†á‰∏ä‰º†
        el("folderIconUpload").addEventListener("click", () => el("folderIconFileInput").click());
        el("folderIconFileInput").addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    el("folderIconPreview").innerHTML = `<img src="${ev.target.result}" width="80" height="80" style="object-fit: contain; border-radius: 10px;">`;
                };
                reader.readAsDataURL(file);
            }
        });

        // ÂàõÂª∫Êñá‰ª∂Â§π
        el("confirmCreateFolderBtn").addEventListener("click", () => {
            const name = el("newFolderNameInput").value.trim();
            if (!name) {
                alert("Please enter a folder name!");
                el("newFolderNameInput").focus();
                return;
            }

            const folderId = `folder_${Date.now()}`;
            folderNames[folderId] = name;
            
            const preview = el("folderIconPreview").innerHTML;
            folderIcons[folderId] = preview.includes('img src=') ? preview.match(/src="(.*?)"/)[1] : "https://via.placeholder.com/70/ff66b3/ffffff?text=üìÅ";
            folderContents[folderId] = {
                section: currMedia,
                files: []
            };

            const folder = document.createElement("div");
            folder.className = "folder-item";
            folder.dataset.id = folderId;
            folder.innerHTML = `
                <button class="delete-folder" style="display: ${isAdmin ? 'flex' : 'none'}">√ó</button>
                <img src="${folderIcons[folderId]}" class="folder-icon" alt="${name}">
                <div class="folder-name" contenteditable="${isAdmin}">${name}</div>
            `;

            const nameEl = folder.querySelector('.folder-name');
            nameEl.addEventListener("keydown", (e) => {
                if (!isAdmin) return;
                if (e.key === 'Enter') {
                    e.preventDefault();
                    nameEl.blur();
                }
            });

            nameEl.addEventListener("blur", () => {
                if (!isAdmin) return;
                const newName = nameEl.textContent.trim() || "New Folder";
                nameEl.textContent = newName;
                folderNames[folderId] = newName;
                saveAllData();
            });

            folder.querySelector(".delete-folder").addEventListener("click", (e) => {
                e.stopPropagation();
                if (!isAdmin) return;
                if (confirm(`Are you sure to delete the folder "${nameEl.textContent}"?\nAll contents inside will also be deleted.`)) {
                    if (folderContents[folderId]) {
                        folderContents[folderId].forEach(file => {
                            if (file.url && file.url.startsWith('blob:')) URL.revokeObjectURL(file.url);
                        });
                    }
                    el(`${currMedia}Media`).removeChild(folder);
                    delete folderIcons[folderId];
                    delete folderNames[folderId];
                    delete folderContents[folderId];
                    saveAllData();
                }
            });

            folder.addEventListener("click", (e) => {
                if (e.target.classList.contains('delete-folder') || e.target.classList.contains('folder-name')) return;
                openFolder(folderId);
            });

            el(`${currMedia}Media`).appendChild(folder);
            
            if (isAdmin) {
                setTimeout(() => {
                    nameEl.focus();
                    const range = document.createRange();
                    const sel = window.getSelection();
                    range.selectNodeContents(nameEl);
                    sel.removeAllRanges();
                    sel.addRange(range);
                }, 200);
            }

            saveAllData();
            
            closeModal("createFolderModal", "createFolderOverlay");
        });

        // ÊâìÂºÄÊñá‰ª∂Â§πËØ¶ÊÉÖ
        function openFolder(folderId) {
            currFolder = folderId;
            el("folderPageTitle").textContent = folderNames[folderId] || "Folder Content";
            el("folderPageModal").style.display = "block";
            el("folderPageOverlay").style.display = "block";
            renderFolderMedia(folderId);
        }

        // Ê∏≤ÊüìÊñá‰ª∂Â§πÂÜÖÂÆπ
        function renderFolderMedia(folderId) {
            el("folderMediaContent").innerHTML = "";
            if (!folderContents[folderId] || !folderContents[folderId].files) return;
            
            folderContents[folderId].files.forEach((file, idx) => {
                const fileEl = document.createElement("div");
                fileEl.className = "file-item";
                fileEl.dataset.index = idx;
                
                let preview = "";
                if (file.type.startsWith("image/")) {
                    preview = `<img src="${file.url}" class="file-icon" alt="${file.name}">`;
                } else if (file.type.startsWith("video/")) {
                    // ËßÜÈ¢ëÊòæÁ§∫Â∞ÅÈù¢ËÄåÈùûÊí≠ÊîæÊéß‰ª∂
                    preview = `<img src="${file.thumbnail || 'https://via.placeholder.com/70/ff99cc/ffffff?text=üé•'}" class="file-icon" alt="${file.name}">`;
                } else {
                    preview = `<div class="file-icon" style="background: #ffd6e8; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #ff66b3;">üìÑ</div>`;
                }

                fileEl.innerHTML = `
                    <button class="delete-file" style="display: ${isAdmin ? 'flex' : 'none'}">√ó</button>
                    ${preview}
                    <div class="file-name" contenteditable="${isAdmin}">${file.name}</div>
                `;

                const fileNameEl = fileEl.querySelector('.file-name');
                fileNameEl.addEventListener("keydown", (e) => {
                    if (!isAdmin) return;
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        fileNameEl.blur();
                    }
                });

                fileNameEl.addEventListener("blur", () => {
                    if (!isAdmin) return;
                    const newName = fileNameEl.textContent.trim() || file.originalName;
                    fileNameEl.textContent = newName;
                    folderContents[folderId].files[idx].name = newName;
                    saveAllData();
                });

                fileEl.querySelector(".delete-file").addEventListener("click", (e) => {
                    e.stopPropagation();
                    if (!isAdmin) return;
                    if (confirm(`Are you sure to delete "${fileNameEl.textContent}"?`)) {
                        if (file.url && file.url.startsWith('blob:')) URL.revokeObjectURL(file.url);
                        folderContents[folderId].files.splice(idx, 1);
                        renderFolderMedia(folderId);
                        saveAllData();
                    }
                });

                // Êñ∞Â¢ûÔºöÁÇπÂáªÊñá‰ª∂È¢ÑËßà
                fileEl.addEventListener("click", (e) => {
                    if (e.target.classList.contains('delete-file') || e.target.classList.contains('file-name')) return;
                    openMediaPreview(folderId, idx);
                });

                el("folderMediaContent").appendChild(fileEl);
                
                if (file.isNew && isAdmin) {
                    setTimeout(() => {
                        fileNameEl.focus();
                        const range = document.createRange();
                        const sel = window.getSelection();
                        range.selectNodeContents(fileNameEl);
                        sel.removeAllRanges();
                        sel.addRange(range);
                        file.isNew = false;
                    }, 200);
                }
            });
        }

        // Êñ∞Â¢ûÔºöÊâìÂºÄÂ™í‰ΩìÈ¢ÑËßà
        function openMediaPreview(folderId, index) {
            currentMediaFolder = folderId;
            currentMediaIndex = index;
            
            const files = folderContents[folderId]?.files || [];
            if (files.length === 0 || index < 0 || index >= files.length) return;
            
            const file = files[index];
            const previewContent = el("mediaPreviewContent");
            previewContent.innerHTML = "";
            
            // ÂÖ≥Èó≠Êñá‰ª∂Â§πÂºπÁ™ó
            closeModal("folderPageModal", "folderPageOverlay");
            
            // ÊòæÁ§∫Â™í‰ΩìÈ¢ÑËßàÂºπÁ™ó
            el("mediaPreviewModal").style.display = "block";
            el("mediaPreviewOverlay").style.display = "block";
            
            // Ê†πÊçÆÊñá‰ª∂Á±ªÂûãÂàõÂª∫È¢ÑËßà
            if (file.type.startsWith("image/")) {
                const img = document.createElement("img");
                img.src = file.url;
                img.alt = file.name;
                img.style.maxWidth = "100%";
                img.style.maxHeight = "80vh";
                img.style.borderRadius = "10px";
                img.style.cursor = "pointer";
                
                // ÁÇπÂáªÂõæÁâáËøõÂÖ•ÂÖ®Â±èÊ®°Âºè
                img.addEventListener("click", () => {
                    if (document.fullscreenElement) {
                        document.exitFullscreen();
                    } else {
                        img.requestFullscreen().catch(err => {
                            console.log(`ÂÖ®Â±èÈîôËØØ: ${err.message}`);
                        });
                    }
                });
                
                previewContent.appendChild(img);
            } else if (file.type.startsWith("video/")) {
                const video = document.createElement("video");
                video.src = file.url;
                video.controls = true;
                video.autoplay = true;
                video.muted = false;
                video.style.maxWidth = "100%";
                video.style.maxHeight = "80vh";
                video.style.borderRadius = "10px";
                video.style.cursor = "pointer";
                
                // ÁÇπÂáªËßÜÈ¢ëËøõÂÖ•ÂÖ®Â±èÊ®°Âºè
                video.addEventListener("click", () => {
                    if (video.requestFullscreen) {
                        if (document.fullscreenElement) {
                            document.exitFullscreen();
                        } else {
                            video.requestFullscreen().catch(err => {
                                console.log(`ÂÖ®Â±èÈîôËØØ: ${err.message}`);
                            });
                        }
                    }
                });
                
                previewContent.appendChild(video);
            }
            
            // Êõ¥Êñ∞ÂØºËà™ÊåâÈíÆÁä∂ÊÄÅ
            updateMediaNavigationButtons();
        }

        // Êñ∞Â¢ûÔºöÊõ¥Êñ∞Â™í‰ΩìÂØºËà™ÊåâÈíÆÁä∂ÊÄÅ
        function updateMediaNavigationButtons() {
            const files = folderContents[currentMediaFolder]?.files || [];
            const prevBtn = el("mediaPreviewPrev");
            const nextBtn = el("mediaPreviewNext");
            
            prevBtn.disabled = currentMediaIndex <= 0;
            nextBtn.disabled = currentMediaIndex >= files.length - 1;
            
            prevBtn.style.opacity = prevBtn.disabled ? "0.5" : "1";
            nextBtn.style.opacity = nextBtn.disabled ? "0.5" : "1";
        }

        // Êñ∞Â¢ûÔºöÂ™í‰ΩìÂØºËà™ÊåâÈíÆ‰∫ã‰ª∂
        el("mediaPreviewPrev").addEventListener("click", () => {
            if (currentMediaIndex > 0) {
                openMediaPreview(currentMediaFolder, currentMediaIndex - 1);
            }
        });

        el("mediaPreviewNext").addEventListener("click", () => {
            const files = folderContents[currentMediaFolder]?.files || [];
            if (currentMediaIndex < files.length - 1) {
                openMediaPreview(currentMediaFolder, currentMediaIndex + 1);
            }
        });

        // ‰∏ä‰º†Â™í‰ΩìÊñá‰ª∂
        el("uploadMediaBtn").addEventListener("click", () => {
            if (!isAdmin) return;
            
            const input = document.createElement("input");
            input.type = "file";
            input.accept = "image/*,video/*";
            input.multiple = true;
            input.click();

            input.addEventListener("change", (e) => {
                const files = e.target.files;
                if (!files.length || !currFolder) return;

                if (!folderContents[currFolder]) folderContents[currFolder] = { section: currMedia, files: [] };
                if (!folderContents[currFolder].files) folderContents[currFolder].files = [];

                for (let file of files) {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        const fileData = {
                            name: file.name,
                            originalName: file.name,
                            type: file.type,
                            url: ev.target.result,
                            isNew: true
                        };
                        
                        // ‰∏∫ËßÜÈ¢ëÊñá‰ª∂ÁîüÊàêÁº©Áï•Âõæ
                        if (file.type.startsWith("video/")) {
                            generateVideoThumbnail(ev.target.result, (thumbnail) => {
                                fileData.thumbnail = thumbnail;
                                folderContents[currFolder].files.push(fileData);
                                renderFolderMedia(currFolder);
                                saveAllData();
                            });
                        } else {
                            folderContents[currFolder].files.push(fileData);
                            renderFolderMedia(currFolder);
                            saveAllData();
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
        });

        // Êñ∞Â¢ûÔºöÁîüÊàêËßÜÈ¢ëÁº©Áï•Âõæ
        function generateVideoThumbnail(videoUrl, callback) {
            const video = document.createElement('video');
            video.src = videoUrl;
            video.addEventListener('loadeddata', () => {
                // ËÆæÁΩÆÂà∞ËßÜÈ¢ëÁöÑÁ¨¨‰∏ÄÂ∏ß
                video.currentTime = 1;
                video.addEventListener('seeked', () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    const thumbnail = canvas.toDataURL('image/jpeg');
                    callback(thumbnail);
                });
            });
        }

        // ÁªëÂÆöÂàõÂª∫Êñá‰ª∂Â§πÊåâÈíÆ
        el("studyAddFolderBtn").addEventListener("click", () => openCreateFolder("study"));
        el("vlogAddFolderBtn").addEventListener("click", () => openCreateFolder("vlog"));
        el("weekAddFolderBtn").addEventListener("click", () => openCreateFolder("week"));
        el("achieveAddFolderBtn").addEventListener("click", () => openCreateFolder("achieve"));

        // ÁõÆÊ†áÁÆ°ÁêÜ
        function renderTargets() {
            el("targetList").innerHTML = "";
            const yearGroups = {};
            
            targets.forEach(t => {
                if (!yearGroups[t.year]) yearGroups[t.year] = [];
                yearGroups[t.year].push(t);
            });

            Object.keys(yearGroups).sort().forEach(year => {
                const yearTargets = yearGroups[year];
                const allDone = yearTargets.every(t => t.completed);
                
                const yearContainer = document.createElement("div");
                yearContainer.className = "year-target-container";
                yearContainer.dataset.year = year;

                const yearHeader = document.createElement("div");
                yearHeader.className = "year-header";
                yearHeader.innerHTML = `
                    <input type="checkbox" class="year-checkbox" ${allDone ? "checked" : ""} data-year="${year}">
                    <span class="year-label">${year} Goals</span>
                `;

                const goalsList = document.createElement("div");
                goalsList.className = "goals-list";

                yearTargets.forEach(target => {
                    const goal = document.createElement("div");
                    goal.className = "goal-item";
                    goal.dataset.id = target.id;
                    goal.innerHTML = `
                        <input type="checkbox" class="goal-checkbox" ${target.completed ? "checked" : ""} data-id="${target.id}">
                        <div class="goal-content">${target.content}</div>
                    `;
                    goalsList.appendChild(goal);

                    goal.querySelector(".goal-checkbox").addEventListener("change", (e) => {
                        const tid = parseInt(e.target.dataset.id);
                        const t = targets.find(t => t.id === tid);
                        if (t) {
                            t.completed = e.target.checked;
                            renderTargets();
                            checkYearDone(year);
                            saveAllData();
                        }
                    });
                });

                yearHeader.querySelector(".year-checkbox").addEventListener("change", (e) => {
                    const y = e.target.dataset.year;
                    const checked = e.target.checked;
                    yearTargets.forEach(t => t.completed = checked);
                    renderTargets();
                    saveAllData();
                    if (checked) generateAchievement(y);
                });

                const actions = document.createElement("div");
                actions.className = "target-actions";
                actions.innerHTML = `
                    <button class="target-edit-btn" style="display: ${isAdmin ? 'inline-block' : 'none'}" data-year="${year}">‚úèÔ∏è Edit</button>
                    <button class="target-delete-btn" style="display: ${isAdmin ? 'inline-block' : 'none'}" data-year="${year}">üóëÔ∏è Delete</button>
                `;

                actions.querySelector(".target-edit-btn").addEventListener("click", () => openEditTarget(year));
                
                actions.querySelector(".target-delete-btn").addEventListener("click", () => {
                    if (!isAdmin) return;
                    if (confirm(`Are you sure to delete all goals for ${year}?`)) {
                        targets = targets.filter(t => t.year !== year);
                        renderTargets();
                        saveAllData();
                    }
                });

                yearContainer.appendChild(yearHeader);
                yearContainer.appendChild(goalsList);
                yearContainer.appendChild(actions);
                el("targetList").appendChild(yearContainer);
            });
        }

        // Ê£ÄÊü•Âπ¥‰ªΩÁõÆÊ†áÂÆåÊàê
        function checkYearDone(year) {
            const yearTargets = targets.filter(t => t.year === year);
            if (yearTargets.every(t => t.completed)) generateAchievement(year);
        }

        // ÁîüÊàêÊàêÂ∞±ÂõæÁâá
        function generateAchievement(year) {
            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="600" height="400" viewBox="0 0 600 400">
                    <rect width="600" height="400" rx="20" ry="20" fill="#ffe6f2"/>
                    <rect x="10" y="10" width="580" height="380" rx="15" ry="15" fill="#fff0f7" stroke="#ff99cc" stroke-width="3"/>
                    <circle cx="80" cy="100" r="50" fill="#ffd6e8"/>
                    <circle cx="70" cy="90" r="10" fill="#ff99cc"/>
                    <circle cx="90" cy="90" r="10" fill="#ff99cc"/>
                    <path d="M70,110 Q80,120 90,110" stroke="#ff66b3" stroke-width="3" fill="none"/>
                    <circle cx="520" cy="300" r="40" fill="#ffb3d9"/>
                    <circle cx="510" cy="290" r="8" fill="#ff66b3"/>
                    <circle cx="530" cy="290" r="8" fill="#ff66b3"/>
                    <path d="M510,310 Q520,320 530,310" stroke="#ff3399" stroke-width="2" fill="none"/>
                    <circle cx="100" cy="300" r="20" fill="#ff66b3" opacity="0.7"/>
                    <circle cx="500" cy="100" r="25" fill="#ff99cc" opacity="0.7"/>
                    <path d="M200,50 C250,10 300,80 350,40" stroke="#ff66b3" stroke-width="5" fill="none" opacity="0.5"/>
                    <path d="M400,350 C350,300 300,380 250,340" stroke="#ff99cc" stroke-width="5" fill="none" opacity="0.5"/>
                    <text x="300" y="150" font-family="Comic Sans MS, Arial Rounded MT Bold, sans-serif" font-size="28" text-anchor="middle" fill="#ff66b3" font-weight="bold">${year} Goals Completed!</text>
                    <text x="300" y="200" font-family="Comic Sans MS, Arial Rounded MT Bold, sans-serif" font-size="24" text-anchor="middle" fill="#5a2e48">${quote}</text>
                    <text x="300" y="250" font-family="Comic Sans MS, Arial Rounded MT Bold, sans-serif" font-size="20" text-anchor="middle" fill="#ff99cc">üéâ Congratulations, Yomi! üéâ</text>
                </svg>
            `;

            const svgUrl = `data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(svg)))}`;
            
            el("achievementImage").src = svgUrl;
            el("achievementImageModal").style.display = "block";
            el("achievementImageOverlay").style.display = "block";

            const addToAchieve = () => {
                const achieveMedia = el("achieveMedia");
                const item = document.createElement("div");
                item.className = "file-item";
                
                item.innerHTML = `
                    <button class="delete-file" style="display: ${isAdmin ? 'flex' : 'none'}">√ó</button>
                    <img src="${svgUrl}" class="file-icon" alt="${year} Achievement">
                    <div class="file-name" contenteditable="${isAdmin}">${year} Goals Achievement</div>
                `;

                item.querySelector(".delete-file").addEventListener("click", (e) => {
                    e.stopPropagation();
                    if (!isAdmin) return;
                    if (confirm(`Are you sure to delete the ${year} achievement?`)) {
                        achieveMedia.removeChild(item);
                        saveAllData();
                    }
                });

                const nameEl = item.querySelector('.file-name');
                nameEl.addEventListener("keydown", (e) => {
                    if (!isAdmin) return;
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        nameEl.blur();
                    }
                });

                nameEl.addEventListener("blur", () => {
                    if (!isAdmin) return;
                    const newName = nameEl.textContent.trim() || `${year} Goals Achievement`;
                    nameEl.textContent = newName;
                    saveAllData();
                });

                // ÁÇπÂáªÈ¢ÑËßàÊàêÂ∞±ÂõæÁâá
                item.addEventListener("click", (e) => {
                    if (e.target.classList.contains('delete-file') || e.target.classList.contains('file-name')) return;
                    const previewContent = el("mediaPreviewContent");
                    previewContent.innerHTML = `<img src="${svgUrl}" style="max-width: 100%; max-height: 80vh; border-radius: 10px; cursor: pointer;">`;
                    
                    // Ê∑ªÂä†ÂÖ®Â±èÁÇπÂáª‰∫ã‰ª∂
                    previewContent.querySelector('img').addEventListener('click', () => {
                        if (document.fullscreenElement) {
                            document.exitFullscreen();
                        } else {
                            previewContent.querySelector('img').requestFullscreen().catch(err => {
                                console.log(`ÂÖ®Â±èÈîôËØØ: ${err.message}`);
                            });
                        }
                    });
                    
                    el("mediaPreviewModal").style.display = "block";
                    el("mediaPreviewOverlay").style.display = "block";
                    updateMediaNavigationButtons();
                });

                if (achieveMedia.firstChild) achieveMedia.insertBefore(item, achieveMedia.firstChild);
                else achieveMedia.appendChild(item);
                
                saveAllData();
            };

            el("confirmAchievementBtn").addEventListener("click", () => {
                closeModal("achievementImageModal", "achievementImageOverlay");
                addToAchieve();
            });
        }

        // ÊâìÂºÄÁõÆÊ†áÁºñËæëÂºπÁ™ó
        function openEditTarget(year = null) {
            if (!isAdmin) return;
            
            el("targetModal").style.display = "block";
            el("targetOverlay").style.display = "block";
            
            if (year) {
                const yearTargets = targets.filter(t => t.year === year);
                el("targetYear").value = year;
                el("targetContent").value = yearTargets.map(t => t.content).join("\n");
                editTargetId = year;
            } else {
                el("targetYear").value = new Date().getFullYear().toString();
                el("targetContent").value = "";
                editTargetId = null;
            }
            
            setTimeout(() => el("targetYear").focus(), 100);
        }

        // ‰øùÂ≠òÁõÆÊ†á
        el("saveTargetBtn").addEventListener("click", () => {
            const year = el("targetYear").value.trim();
            const content = el("targetContent").value.trim();
            
            if (!year || !content) {
                alert("Please fill in both year and target content!");
                return;
            }

            const goals = content.split("\n").filter(line => line.trim()).map(line => line.trim());
            
            if (editTargetId) {
                targets = targets.filter(t => t.year !== editTargetId);
            }
            
            goals.forEach(goal => {
                targets.push({
                    id: idCounter++,
                    year: year,
                    content: goal,
                    completed: false
                });
            });

            renderTargets();
            saveAllData();
            closeModal("targetModal", "targetOverlay");
            editTargetId = null;
        });

        // ÁªëÂÆöÊ∑ªÂä†ÁõÆÊ†áÊåâÈíÆ
        el("addTargetBtn").addEventListener("click", () => openEditTarget());

        // ========== Ë¥¥Á∫∏ÂäüËÉΩ ==========
        
        // ‰øùÂ≠òÂΩìÂâçÈ°µÈù¢ÁöÑË¥¥Á∫∏Áä∂ÊÄÅ
        function savePageStickers(pageId) {
            const container = el(`stickerContainer_${pageId}`);
            const stickers = [];
            
            container.querySelectorAll('.sticker-item').forEach(sticker => {
                const stickerData = {
                    id: sticker.dataset.stickerId,
                    type: sticker.dataset.type,
                    url: sticker.dataset.url,
                    top: sticker.style.top,
                    left: sticker.style.left,
                    width: sticker.style.width,
                    height: sticker.style.height,
                    transform: sticker.style.transform
                };
                stickers.push(stickerData);
            });
            
            pageStickers[pageId] = stickers;
        }

        // Âä†ËΩΩÊåáÂÆöÈ°µÈù¢ÁöÑË¥¥Á∫∏
        function loadPageStickers(pageId) {
            const container = el(`stickerContainer_${pageId}`);
            if (!container) return;
            
            container.innerHTML = "";
            
            const stickers = pageStickers[pageId] || [];
            stickers.forEach(stickerData => {
                if (!stickerData || !stickerData.id || !stickerData.url) {
                    console.warn('Invalid sticker data:', stickerData);
                    return;
                }
                
                const sticker = document.createElement("div");
                sticker.className = "sticker-item";
                sticker.dataset.stickerId = stickerData.id;
                sticker.dataset.type = stickerData.type || 'image/png';
                sticker.dataset.url = stickerData.url;
                sticker.style.top = stickerData.top || '50px';
                sticker.style.left = stickerData.left || '50px';
                sticker.style.width = stickerData.width || '150px';
                sticker.style.height = stickerData.height || '150px';
                sticker.style.transform = stickerData.transform || 'rotate(0deg)';
                
                sticker.style.position = 'absolute';
                sticker.style.pointerEvents = isAdmin && stickerEdit ? 'all' : 'auto';
                
                if (stickerData.type && stickerData.type.startsWith("image/")) {
                    sticker.innerHTML = `
                        <img src="${stickerData.url}" style="width: 100%; height: 100%; object-fit: contain;">
                        <div class="sticker-handle"></div>
                        <div class="sticker-rotate-tip">‚Ü∫</div>
                        <div class="sticker-flip-handle">üîÑ</div>
                        <div class="sticker-delete-handle">√ó</div>
                    `;
                } else if (stickerData.type && stickerData.type.startsWith("video/")) {
                    sticker.innerHTML = `
                        <video src="${stickerData.url}" style="width: 100%; height: 100%; object-fit: contain;" autoplay loop muted playsinline></video>
                        <div class="sticker-handle"></div>
                        <div class="sticker-rotate-tip">‚Ü∫</div>
                        <div class="sticker-flip-handle">üîÑ</div>
                        <div class="sticker-delete-handle">√ó</div>
                    `;
                } else {
                    sticker.innerHTML = `
                        <img src="${stickerData.url}" style="width: 100%; height: 100%; object-fit: contain;">
                        <div class="sticker-handle"></div>
                        <div class="sticker-rotate-tip">‚Ü∫</div>
                        <div class="sticker-flip-handle">üîÑ</div>
                        <div class="sticker-delete-handle">√ó</div>
                    `;
                }
                
                sticker.addEventListener("click", (e) => {
                    if (!stickerEdit) return;
                    e.stopPropagation();
                    
                    els('.sticker-item').forEach(s => {
                        s.style.outline = 'none';
                    });
                    
                    selectedSticker = sticker;
                    sticker.style.outline = '2px solid #ff66b3';
                });
                
                // Êñ∞Â¢ûÔºöÁÇπÂáªÂà†Èô§ÊåâÈíÆÂà†Èô§Ë¥¥Á∫∏
                const deleteHandle = sticker.querySelector('.sticker-delete-handle');
                if (deleteHandle) {
                    deleteHandle.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (stickerEdit) {
                            currentDeleteSticker = sticker;
                            el("deleteStickerModal").style.display = "block";
                            el("deleteStickerOverlay").style.display = "block";
                        }
                    });
                }
                
                container.appendChild(sticker);
                
                initStickerDrag(sticker);
                initStickerResize(sticker);
                initStickerRotate(sticker);
                initStickerFlipMenu(sticker);
                
                if (isAdmin && stickerEdit) {
                    sticker.classList.add('editable');
                }
            });
        }

        el("stickerButton").addEventListener("click", () => {
            if (!isAdmin) return;
            
            if (!stickerEdit) {
                stickerEdit = true;
                el("stickerButton").textContent = "‚úÖ";
                el("stickerButton").style.backgroundColor = "#ff3399";
                el("stickerToolbar").style.display = "block";
                
                const container = el(`stickerContainer_${currentPageId}`);
                container.querySelectorAll('.sticker-item').forEach(sticker => {
                    sticker.classList.add('editable');
                    sticker.style.pointerEvents = 'all';
                });
                
                openStickerFileSelector();
            } else {
                el("stickerConfirmModal").style.display = "block";
                el("stickerConfirmOverlay").style.display = "block";
            }
        });

        // ÊâìÂºÄË¥¥Á∫∏Êñá‰ª∂ÈÄâÊã©Âô®
        function openStickerFileSelector() {
            const input = document.createElement("input");
            input.type = "file";
            input.accept = "image/*,video/*";
            input.multiple = true;
            input.click();
            
            input.addEventListener("change", (e) => {
                const files = e.target.files;
                if (files && stickerEdit) {
                    Array.from(files).forEach(file => addSticker(file));
                }
            });
        }

        // ÁªëÂÆöÊ∑ªÂä†Êñ∞Ë¥¥Á∫∏ÊåâÈíÆ
        el("addNewStickerBtn").addEventListener("click", () => {
            if (stickerEdit) openStickerFileSelector();
        });

        // ÁøªËΩ¨ÂäüËÉΩÂÆûÁé∞
        function flipSticker(sticker, direction) {
            if (!sticker) return;
            
            let currentTransform = sticker.style.transform || 'none';
            
            let scaleX = 1;
            let scaleY = 1;
            const scaleXMatch = currentTransform.match(/scaleX\(([-+]?\d*\.?\d+)\)/);
            const scaleYMatch = currentTransform.match(/scaleY\(([-+]?\d*\.?\d+)\)/);
            
            if (scaleXMatch) scaleX = parseFloat(scaleXMatch[1]);
            if (scaleYMatch) scaleY = parseFloat(scaleYMatch[1]);
            
            if (direction === 'horizontal') {
                scaleX = scaleX * -1;
                currentTransform = currentTransform.replace(/scaleX\([-+]?\d*\.?\d+\)/g, '');
                currentTransform += ` scaleX(${scaleX})`;
            } else if (direction === 'vertical') {
                scaleY = scaleY * -1;
                currentTransform = currentTransform.replace(/scaleY\([-+]?\d*\.?\d+\)/g, '');
                currentTransform += ` scaleY(${scaleY})`;
            }
            
            currentTransform = currentTransform.trim().replace(/\s+/g, ' ');
            if (currentTransform === '') currentTransform = 'none';
            
            sticker.style.transform = currentTransform;
        }

        // ÁªëÂÆöÊ∞¥Âπ≥ÁøªËΩ¨ÊåâÈíÆ
        el("flipHorizontalBtn").addEventListener("click", () => {
            if (selectedSticker && stickerEdit) {
                flipSticker(selectedSticker, 'horizontal');
            } else {
                alert("Please select a sticker first!");
            }
        });

        // ÁªëÂÆöÂûÇÁõ¥ÁøªËΩ¨ÊåâÈíÆ
        el("flipVerticalBtn").addEventListener("click", () => {
            if (selectedSticker && stickerEdit) {
                flipSticker(selectedSticker, 'vertical');
            } else {
                alert("Please select a sticker first!");
            }
        });

        // Á°ÆËÆ§ÂÆåÊàêË¥¥Á∫∏ÁºñËæë
        el("confirmStickerBtn").addEventListener("click", () => {
            finishSticker(true);
        });

        // ÂèñÊ∂àË¥¥Á∫∏ÁºñËæë
        el("cancelStickerBtn").addEventListener("click", () => {
            finishSticker(false);
        });

        // ÂÆåÊàêË¥¥Á∫∏ÁºñËæëÈÄªËæë
        function finishSticker(saveChanges) {
            if (saveChanges) {
                savePageStickers(currentPageId);
                saveAllData();
            } else {
                loadPageStickers(currentPageId);
            }
            
            stickerEdit = false;
            selectedSticker = null;
            el("stickerButton").textContent = "üç™";
            el("stickerButton").style.backgroundColor = "#ff66b3";
            el("stickerToolbar").style.display = "none";
            el("stickerConfirmModal").style.display = el("stickerConfirmOverlay").style.display = "none";
            
            const container = el(`stickerContainer_${currentPageId}`);
            container.querySelectorAll('.sticker-item').forEach(sticker => {
                sticker.classList.remove('editable');
                sticker.style.outline = 'none';
                sticker.style.pointerEvents = 'auto';
            });
        }

        // Ê∑ªÂä†Ë¥¥Á∫∏
        function addSticker(file) {
            const container = el(`stickerContainer_${currentPageId}`);
            const stickerId = `sticker_${Date.now()}_${Math.floor(Math.random() * 1000)}`;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Url = e.target.result;
            
                const sticker = document.createElement("div");
                sticker.className = "sticker-item editable";
                sticker.dataset.stickerId = stickerId;
                sticker.dataset.type = file.type;
                sticker.dataset.url = base64Url;
                
                const startX = 50 + Math.random() * (container.clientWidth - 200);
                const startY = 50 + Math.random() * (container.clientHeight - 200);
                sticker.style.top = `${startY}px`;
                sticker.style.left = `${startX}px`;
                sticker.style.width = "150px";
                sticker.style.height = "150px";
                sticker.style.transform = "rotate(0deg)";
                
                if (file.type.startsWith("image/")) {
                    sticker.innerHTML = `
                        <img src="${base64Url}" style="width: 100%; height: 100%; object-fit: contain;">
                        <div class="sticker-handle"></div>
                        <div class="sticker-rotate-tip">‚Ü∫</div>
                        <div class="sticker-flip-handle">üîÑ</div>
                        <div class="sticker-delete-handle">√ó</div>
                    `;
                } else if (file.type.startsWith("video/")) {
                    sticker.innerHTML = `
                        <video src="${base64Url}" style="width: 100%; height: 100%; object-fit: contain;" autoplay loop muted playsinline></video>
                        <div class="sticker-handle"></div>
                        <div class="sticker-rotate-tip">‚Ü∫</div>
                        <div class="sticker-flip-handle">üîÑ</div>
                        <div class="sticker-delete-handle">√ó</div>
                    `;
                }
                
                sticker.addEventListener("click", (e) => {
                    if (!stickerEdit) return;
                    e.stopPropagation();
                    
                    els('.sticker-item').forEach(s => {
                        s.style.outline = 'none';
                    });
                    
                    selectedSticker = sticker;
                    sticker.style.outline = '2px solid #ff66b3';
                });
                
                // Êñ∞Â¢ûÔºöÁÇπÂáªÂà†Èô§ÊåâÈíÆÂà†Èô§Ë¥¥Á∫∏
                const deleteHandle = sticker.querySelector('.sticker-delete-handle');
                if (deleteHandle) {
                    deleteHandle.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (stickerEdit) {
                            currentDeleteSticker = sticker;
                            el("deleteStickerModal").style.display = "block";
                            el("deleteStickerOverlay").style.display = "block";
                        }
                    });
                }
                
                container.appendChild(sticker);
                
                initStickerDrag(sticker);
                initStickerResize(sticker);
                initStickerRotate(sticker);
                initStickerFlipMenu(sticker);
                
                selectedSticker = sticker;
                sticker.style.outline = '2px solid #ff66b3';
            };
            
            reader.readAsDataURL(file);
        }

        // ÂàùÂßãÂåñË¥¥Á∫∏ÊãñÊãΩ
        function initStickerDrag(sticker) {
            let isDragging = false;
            let startX, startY, initialX, initialY;
            
            sticker.addEventListener("mousedown", (e) => {
                if (!stickerEdit || e.target.classList.contains('sticker-handle') || 
                    e.target.classList.contains('sticker-rotate-tip') || 
                    e.target.classList.contains('sticker-flip-handle') ||
                    e.target.classList.contains('sticker-delete-handle')) {
                    return;
                }
                
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                
                initialX = parseFloat(sticker.style.left) || 0;
                initialY = parseFloat(sticker.style.top) || 0;
                
                sticker.style.zIndex = 901;
                
                document.body.style.cursor = "move";
                
                e.preventDefault();
            });
            
            document.addEventListener("mousemove", (e) => {
                if (!isDragging || !stickerEdit) return;
                
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                
                sticker.style.left = `${initialX + dx}px`;
                sticker.style.top = `${initialY + dy}px`;
            });
            
            document.addEventListener("mouseup", () => {
                if (isDragging) {
                    isDragging = false;
                    document.body.style.cursor = "default";
                }
            });
            
            sticker.addEventListener("touchstart", (e) => {
                if (!stickerEdit || e.target.classList.contains('sticker-handle') || 
                    e.target.classList.contains('sticker-rotate-tip') || 
                    e.target.classList.contains('sticker-flip-handle') ||
                    e.target.classList.contains('sticker-delete-handle')) {
                    return;
                }
                
                isDragging = true;
                const touch = e.touches[0];
                startX = touch.clientX;
                startY = touch.clientY;
                
                initialX = parseFloat(sticker.style.left) || 0;
                initialY = parseFloat(sticker.style.top) || 0;
                
                sticker.style.zIndex = 901;
                e.preventDefault();
            });
            
            document.addEventListener("touchmove", (e) => {
                if (!isDragging || !stickerEdit) return;
                
                const touch = e.touches[0];
                const dx = touch.clientX - startX;
                const dy = touch.clientY - startY;
                
                sticker.style.left = `${initialX + dx}px`;
                sticker.style.top = `${initialY + dy}px`;
                e.preventDefault();
            });
            
            document.addEventListener("touchend", () => {
                isDragging = false;
            });
        }

        // ÂàùÂßãÂåñË¥¥Á∫∏Áº©Êîæ
        function initStickerResize(sticker) {
            const handle = sticker.querySelector('.sticker-handle');
            if (!handle) return;
            
            let isResizing = false;
            let startX, startY;
            let initialWidth, initialHeight;
            
            handle.addEventListener("mousedown", (e) => {
                if (!stickerEdit) return;
                
                isResizing = true;
                startX = e.clientX;
                startY = e.clientY;
                
                initialWidth = parseFloat(sticker.style.width) || 150;
                initialHeight = parseFloat(sticker.style.height) || 150;
                
                sticker.style.zIndex = 901;
                
                document.body.style.cursor = "nwse-resize";
                
                e.preventDefault();
            });
            
            document.addEventListener("mousemove", (e) => {
                if (!isResizing || !stickerEdit) return;
                
                const dx = e.clientX - startX;
                const dy = e.clientY - startY;
                
                const newWidth = Math.max(50, initialWidth + dx);
                const aspectRatio = initialHeight / initialWidth;
                const newHeight = newWidth * aspectRatio;
                
                sticker.style.width = `${newWidth}px`;
                sticker.style.height = `${newHeight}px`;
            });
            
            document.addEventListener("mouseup", () => {
                if (isResizing) {
                    isResizing = false;
                    document.body.style.cursor = "default";
                }
            });
            
            handle.addEventListener("touchstart", (e) => {
                if (!stickerEdit) return;
                
                isResizing = true;
                const touch = e.touches[0];
                startX = touch.clientX;
                startY = touch.clientY;
                
                initialWidth = parseFloat(sticker.style.width) || 150;
                initialHeight = parseFloat(sticker.style.height) || 150;
                
                sticker.style.zIndex = 901;
                e.preventDefault();
            });
            
            document.addEventListener("touchmove", (e) => {
                if (!isResizing || !stickerEdit) return;
                
                const touch = e.touches[0];
                const dx = touch.clientX - startX;
                const dy = touch.clientY - startY;
                
                const newWidth = Math.max(50, initialWidth + dx);
                const aspectRatio = initialHeight / initialWidth;
                const newHeight = newWidth * aspectRatio;
                
                sticker.style.width = `${newWidth}px`;
                sticker.style.height = `${newHeight}px`;
                e.preventDefault();
            });
            
            document.addEventListener("touchend", () => {
                isResizing = false;
            });
        }

        // ÂàùÂßãÂåñË¥¥Á∫∏ÊóãËΩ¨
        function initStickerRotate(sticker) {
            const rotateTip = sticker.querySelector('.sticker-rotate-tip');
            if (!rotateTip) return;
            
            rotateTip.addEventListener("mousedown", startRotate);
            rotateTip.addEventListener("touchstart", (e) => {
                e.preventDefault();
                startRotate(e);
            });
            
            function startRotate(e) {
                if (!stickerEdit) return;
                
                isRotating = true;
                rotateSticker = sticker;
                
                const transform = sticker.style.transform || 'rotate(0deg)';
                const rotateMatch = transform.match(/rotate\(([-+]?\d*\.?\d+)deg\)/);
                rotateStartAngle = rotateMatch ? parseFloat(rotateMatch[1]) : 0;
                
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                
                const rect = sticker.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                rotateStartX = clientX;
                rotateStartY = clientY;
                
                document.body.style.cursor = "grab";
                
                e.preventDefault();
            }
            
            function handleRotate(e) {
                if (!isRotating || !rotateSticker || !stickerEdit) return;
                
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                
                const rect = rotateSticker.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                const startAngle = Math.atan2(rotateStartY - centerY, rotateStartX - centerX);
                const currentAngle = Math.atan2(clientY - centerY, clientX - centerX);
                const angleDiff = (currentAngle - startAngle) * (180 / Math.PI);
                
                const newAngle = rotateStartAngle + angleDiff;
                let transform = rotateSticker.style.transform || '';
                
                transform = transform.replace(/rotate\([-+]?\d*\.?\d+deg\)/g, '');
                transform += ` rotate(${newAngle}deg)`;
                transform = transform.trim().replace(/\s+/g, ' ');
                
                rotateSticker.style.transform = transform;
                
                e.preventDefault();
            }
            
            function endRotate() {
                if (isRotating) {
                    isRotating = false;
                    rotateSticker = null;
                    document.body.style.cursor = "default";
                }
            }
            
            document.addEventListener("mousemove", handleRotate);
            document.addEventListener("touchmove", (e) => {
                e.preventDefault();
                handleRotate(e);
            });
            
            document.addEventListener("mouseup", endRotate);
            document.addEventListener("touchend", endRotate);
        }

        // ÂàùÂßãÂåñË¥¥Á∫∏ÁøªËΩ¨ËèúÂçï
        function initStickerFlipMenu(sticker) {
            const flipHandle = sticker.querySelector('.sticker-flip-handle');
            if (!flipHandle) return;
            
            let flipMenu = sticker.querySelector('.sticker-flip-menu');
            if (!flipMenu) {
                flipMenu = document.createElement('div');
                flipMenu.className = 'sticker-flip-menu';
                flipMenu.innerHTML = `
                    <div class="flip-option" data-direction="horizontal">‚ÜîÔ∏è Ê∞¥Âπ≥ÁøªËΩ¨</div>
                    <div class="flip-option" data-direction="vertical">‚ÜïÔ∏è ÂûÇÁõ¥ÁøªËΩ¨</div>
                `;
                sticker.appendChild(flipMenu);
                
                flipMenu.querySelectorAll('.flip-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const direction = option.dataset.direction;
                        flipSticker(sticker, direction);
                        flipMenu.style.display = 'none';
                    });
                });
            }
            
            flipHandle.addEventListener('click', (e) => {
                if (!stickerEdit) return;
                e.stopPropagation();
                
                flipMenu.style.display = flipMenu.style.display === 'block' ? 'none' : 'block';
                
                document.addEventListener('click', function closeMenuHandler(ev) {
                    if (!sticker.contains(ev.target)) {
                        flipMenu.style.display = 'none';
                        document.removeEventListener('click', closeMenuHandler);
                    }
                }, { once: true });
            });
        }

        // ÂàùÂßãÂåñÈ°µÈù¢
        window.addEventListener("DOMContentLoaded", () => {
            loadAllData();
            ensureStickerContainers();
            renderAllFolders();
            renderTargets();
            renderProfileData();
            loadPageStickers('home');
            
            if (!isAdmin) {
                document.getElementById('stickerButton').style.display = 'none';
            }
            
            document.addEventListener("click", (e) => {
                if (stickerEdit && !e.target.closest('.sticker-item') && 
                    !e.target.closest('.sticker-toolbar') && 
                    e.target.id !== 'stickerButton') {
                    els('.sticker-item').forEach(s => {
                        s.style.outline = 'none';
                    });
                    selectedSticker = null;
                }
            });
            
            // ÂêØÂä®Ëá™Âä®ÂêåÊ≠•
            startAutoSync();
            
            // ÁõëÂê¨È°µÈù¢Âç∏ËΩΩ‰∫ã‰ª∂Ôºå‰øùÂ≠òÊï∞ÊçÆ
            window.addEventListener('beforeunload', () => {
                saveAllData();
                stopAutoSync();
            });
        });

        // È¶ñÈ°µÂ§¥ÂÉè & Ê†∑ÂºèÁºñËæë
        el("profileImage").addEventListener("click", () => {
            if (!isAdmin) return;
            const input = document.createElement("input");
            input.type = "file";
            input.accept = "image/*";
            input.click();
            input.onchange = (e) => {
                const f = e.target.files[0];
                if (!f) return;
                el("profileImage").src = URL.createObjectURL(f);
            };
        });

        el("profileTextColor").addEventListener("input", () => {
            el("profileInfo").style.color = el("profileTextColor").value;
        });
        el("profileFont").addEventListener("change", () => {
            el("profileInfo").style.fontFamily = el("profileFont").value;
        });
    </script>
</body>
</html>
