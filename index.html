<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yomi's World</title>
    <style>
        /* å…¨å±€æ ·å¼ - é€‚é…ç²‰è‰²å¯çˆ±é£æ ¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Comic Sans MS", "Arial Rounded MT Bold", sans-serif;
        }

        body {
            background-color: #ffe6f2;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23ffb3d9" fill-opacity="0.2" d="M30,10 Q50,0 70,10 Q90,20 90,40 Q90,60 70,70 Q50,80 30,70 Q10,60 10,40 Q10,20 30,10 Z"/></svg>');
            color: #5a2e48;
            overflow-x: hidden;
        }

        /* ä¾§è¾¹å¯¼èˆªæ  - æ ¸å¿ƒå¸ƒå±€å˜æ›´ */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 220px;
            background-color: #ff99cc;
            padding: 30px 15px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 999;
        }

        .sidebar h2 {
            color: white;
            text-align: center;
            margin-bottom: 40px;
            font-size: 20px;
            text-shadow: 1px 1px 2px #ff66b3;
        }

        .sidebar-btn {
            display: block;
            width: 100%;
            padding: 12px 15px;
            margin: 10px 0;
            background-color: white;
            border: none;
            border-radius: 20px;
            color: #ff66b3;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .sidebar-btn:hover {
            background-color: #ff66b3;
            color: white;
            transform: translateX(5px);
        }

        /* ç™»å½•æŒ‰é’® - ç§»åˆ°ä¾§è¾¹æ é¡¶éƒ¨ */
        .login-section {
            text-align: center;
            margin-bottom: 20px;
        }

        .login-btn {
            padding: 10px 15px;
            background-color: #ff66b3;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .login-btn:hover {
            background-color: #ff3399;
            transform: scale(1.05);
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            margin-left: 220px;
            padding: 40px;
            min-height: 100vh;
        }

        /* é¡µé¢æ ‡é¢˜æ ·å¼ */
        .page-title {
            color: #ff66b3;
            font-size: 26px;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 1px 1px 3px #ffb3d9;
        }

        /* å†…å®¹ç›’å­æ ·å¼ - é€‚é…æ–°é£æ ¼ */
        .content-section {
            background-color: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(255, 102, 179, 0.1);
            margin-bottom: 30px;
        }

        .section-title {
            color: #ff66b3;
            font-size: 20px;
            margin-bottom: 1rem;
            border-bottom: 2px solid #ffb3d9;
            padding-bottom: 0.5rem;
            text-shadow: 1px 1px 2px #ffd6e8;
        }

        /* å•ä¸ªåŠ å·æŒ‰é’®æ ·å¼ - æ¯ä¸ªsectionåªæœ‰ä¸€ä¸ª */
        .add-folder-btn {
            margin: 1rem 0;
            padding: 10px 20px;
            background-color: #ff66b3;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: none; /* ä»…ç®¡ç†å‘˜å¯è§ */
        }

        .add-folder-btn:hover {
            background-color: #ff3399;
            transform: scale(1.05);
        }

        /* æ–‡ä»¶/æ–‡ä»¶å¤¹ç®¡ç†æ ·å¼ - ä»¿ç”µè„‘æ–‡ä»¶å¤¹æ ·å¼ */
        .media-section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
            padding: 1rem;
            background-color: #fff8fc;
            border-radius: 15px;
            border: 1px solid #ffd6e8;
        }

        /* ä»¿ç”µè„‘æ–‡ä»¶å¤¹æ ·å¼ */
        .folder-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            border-radius: 12px;
            background-color: #fff;
            border: 1px solid #ffd6e8;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            height: 160px;
            justify-content: center;
        }

        .folder-item:hover {
            background-color: #fff0f7;
            border-color: #ff66b3;
            box-shadow: 0 4px 12px rgba(255, 102, 179, 0.15);
        }

        .folder-icon {
            width: 70px;
            height: 70px;
            object-fit: contain;
            margin-bottom: 0.8rem;
            border-radius: 8px;
        }

        .folder-name {
            width: 100%;
            text-align: center;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 14px;
            color: #5a2e48;
            word-break: break-word;
            margin-bottom: 0.5rem;
            max-height: 40px;
            overflow: hidden;
        }

        /* ç¼–è¾‘æ–‡ä»¶å¤¹åç§°æ—¶çš„æ ·å¼ - ä»¿ç³»ç»Ÿ */
        .folder-name[contenteditable="true"]:focus {
            outline: 2px solid #ff66b3;
            background-color: #fff;
        }

        /* åˆ é™¤æŒ‰é’®æ ·å¼ - æ˜¾çœ¼ä¸”å›ºå®šä½ç½® */
        .delete-folder, .delete-file {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #ff6666;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            opacity: 0.8;
            display: none; /* é»˜è®¤éšè—ï¼Œç®¡ç†å‘˜å¯è§ */
        }

        .delete-folder:hover, .delete-file:hover {
            background: #ff3333;
            transform: scale(1.1);
            opacity: 1;
        }

        /* æ–‡ä»¶æ ·å¼ */
        .file-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            border-radius: 12px;
            background-color: #fff;
            border: 1px solid #ffd6e8;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            height: 160px;
            justify-content: center;
        }

        .file-item:hover {
            background-color: #fff0f7;
            border-color: #ff66b3;
            box-shadow: 0 4px 12px rgba(255, 102, 179, 0.15);
        }

        .file-icon {
            width: 70px;
            height: 70px;
            object-fit: contain;
            margin-bottom: 0.8rem;
            border-radius: 8px;
        }

        .file-name {
            width: 100%;
            text-align: center;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 13px;
            color: #5a2e48;
            word-break: break-word;
            max-height: 40px;
            overflow: hidden;
        }

        /* ä¸ªäººç›®æ ‡æ ·å¼ */
        .personal-target {
            position: relative;
        }

        .add-target-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            display: none; /* ä»…ç®¡ç†å‘˜å¯è§ */
            padding: 10px 20px;
            background-color: #ff66b3;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .add-target-btn:hover {
            background-color: #ff3399;
            transform: scale(1.05);
        }

        /* å¼¹çª—æ ·å¼ - é€‚é…ç²‰è‰²é£æ ¼ */
        .login-modal, .create-folder-modal, .exit-edit-modal, .target-modal, .folder-page-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(255, 102, 179, 0.3);
            z-index: 1000;
            width: 90%;
            max-width: 500px;
        }

        /* æ–‡ä»¶å¤¹è¯¦æƒ…é¡µé¢å¼¹çª—ï¼ˆæ–°ç½‘é¡µï¼‰ */
        .folder-page-modal {
            max-width: 800px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 153, 204, 0.5);
            z-index: 999;
        }

        /* å¼¹çª—å†…æ§ä»¶æ ·å¼ */
        .login-modal input, .create-folder-modal input, .target-modal input {
            margin: 0.5rem 0;
            padding: 10px 15px;
            width: 100%;
            border: 2px solid #ffb3d9;
            border-radius: 15px;
            outline: none;
            color: #5a2e48;
        }

        .confirmBtn, .saveTargetBtn, .confirmCreateFolderBtn, .upload-media-btn {
            background-color: #ff66b3;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 10px 20px;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .cancelBtn, .cancelTargetBtn, .cancelCreateFolderBtn, .close-folder-page {
            background-color: #ffb3d9;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .confirmBtn:hover, .saveTargetBtn:hover, .confirmCreateFolderBtn:hover, .upload-media-btn:hover {
            background-color: #ff3399;
            transform: scale(1.05);
        }

        .cancelBtn:hover, .cancelTargetBtn:hover, .cancelCreateFolderBtn:hover, .close-folder-page:hover {
            background-color: #ff99cc;
            transform: scale(1.05);
        }

        /* æ–‡ä»¶å¤¹å›¾æ ‡ä¸Šä¼ åŒºåŸŸ */
        .folder-icon-upload {
            margin: 1rem 0;
            padding: 1rem;
            border: 2px dashed #ffb3d9;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
        }

        .folder-icon-upload:hover {
            border-color: #ff66b3;
            background-color: #fff0f7;
        }

        .icon-preview {
            width: 80px;
            height: 80px;
            margin: 1rem auto;
            border-radius: 10px;
            object-fit: contain;
            background-color: #fff8fc;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ff66b3;
            font-size: 30px;
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 768px) {
            .sidebar {
                width: 180px;
            }
            .main-content {
                margin-left: 180px;
                padding: 20px;
            }
            .media-section {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            .home-container {
                flex-direction: column;
                text-align: center;
            }
            .character-img {
                margin: 0 auto 2rem;
            }
        }

        /* é¦–é¡µæ ·å¼ */
        .home-page {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 50px;
            padding: 20px;
        }

        .profile-card {
            background-color: white;
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(255, 102, 179, 0.2);
            max-width: 400px;
        }

        .profile-card h1 {
            color: #ff66b3;
            font-size: 28px;
            margin-bottom: 20px;
            text-align: center;
        }

        .profile-info {
            margin: 15px 0;
            line-height: 1.8;
        }

        .profile-info span {
            font-weight: bold;
            color: #ff66b3;
        }

        .cartoon-img {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid #ff99cc;
            box-shadow: 0 5px 15px rgba(255, 102, 179, 0.3);
        }
    </style>
</head>
<body>
    <!-- ä¾§è¾¹å¯¼èˆªæ  -->
    <div class="sidebar">
        <h2>Yomi's World</h2>
        
        <!-- ç™»å½•æŒ‰é’®åŒºåŸŸ - ç§»åˆ°ä¾§è¾¹æ  -->
        <div class="login-section">
            <button class="login-btn" id="loginBtn">Management Login</button>
        </div>

        <!-- å¯¼èˆªæŒ‰é’® - æ–°å¢é¦–é¡µæŒ‰é’® -->
        <button class="sidebar-btn" onclick="navigateTo('home')">ğŸ  Home</button>
        <button class="sidebar-btn" onclick="navigateTo('study')">ğŸ“š Study Diary</button>
        <button class="sidebar-btn" onclick="navigateTo('vlog')">ğŸ¥ Daily Vlog</button>
        <button class="sidebar-btn" onclick="navigateTo('week')">ğŸ“– Week Diary</button>
        <button class="sidebar-btn" onclick="navigateTo('achieve')">ğŸ† Achievements</button>
        <button class="sidebar-btn" onclick="navigateTo('target')">ğŸ¯ Personal Target</button>
    </div>

    <!-- ç™»å½•å¼¹çª— -->
    <div class="overlay" id="loginOverlay"></div>
    <div class="login-modal" id="loginModal">
        <h3 style="color: #ff66b3; text-align: center; margin-bottom: 1rem;">Management Login</h3>
        <input type="password" id="passwordInput" placeholder="Enter password">
        <button id="submitLogin" style="width: 100%; background: #ff66b3; color: white; border: none; border-radius: 15px; padding: 10px; cursor: pointer; margin-top: 1rem;">Login</button>
        <p id="loginError" style="color: #ff6666; margin-top: 0.5rem; display: none; text-align: center;">Wrong password!</p>
    </div>

    <!-- é€€å‡ºç¼–è¾‘æ¨¡å¼å¼¹çª— -->
    <div class="overlay" id="exitEditOverlay"></div>
    <div class="exit-edit-modal" id="exitEditModal">
        <h3 style="color: #ff66b3; text-align: center; margin-bottom: 1rem;">Exit Edit Mode?</h3>
        <p style="text-align: center; margin-bottom: 1rem; color: #5a2e48;">Are you sure you want to end edit mode?</p>
        <div style="display: flex; justify-content: center; gap: 10px;">
            <button id="confirmExitEdit" class="confirmBtn">Yes</button>
            <button id="cancelExitEdit" class="cancelBtn">No</button>
        </div>
    </div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-content" id="main-content">
        <!-- é¦–é¡µ -->
        <div id="home" class="page-content">
            <div class="home-page">
                <!-- å…³é”®ä¿®æ”¹å¤„ï¼šæ›¿æ¢srcä¸ºä½ æä¾›çš„å›¾ç‰‡é“¾æ¥ -->
                <img src="https://p3-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/eff44eee1e6e4f2792c1775615dc2c74.JPG~tplv-a9rns2rl98-24:720:720.image?lk3s=8e244e95&rcl=202602080916150F3B363E9BA71B184F7A&rrcfp=8a172a1a&x-expires=1771118176&x-signature=rbjW80X3iJyV3cv9f5kR3omsSlc%3D" alt="Yomi's Profile" class="cartoon-img">
                <div class="profile-card">
                    <h1>About Me ğŸ’–</h1>
                    <div class="profile-info">
                        <p><span>Name:</span> Yomi Qiu</p>
                        <p><span>Birthday:</span> 2010.03.25</p>
                        <p><span>MBTI:</span> INTJ</p>
                        <p><span>Hobbies:</span> Playing Tennis, Finding Dilicious Food, Mediating</p>
                        <p><span>Self-introduction:</span> Hello! I'm Yomi, born on March 25, 2010. As an INTJ, I'm a thoughtful and independent person who loves to explore the world around me. 
                                I enjoy reading, creating art, and documenting my daily life through diaries and vlogs. 
                                This little corner of the internet is where I share my study journey, daily life, and personal goals. 
                                Welcome to my world!</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Study Diary åŒºåŸŸ - å•ä¸ªåŠ å·æŒ‰é’® -->
        <div id="study" class="page-content" style="display: none;">
            <h2 class="page-title">ğŸ“š Study Diary</h2>
            <section class="content-section">
                <h3 class="section-title">My Study Records</h3>
                <button class="add-folder-btn" id="studyAddFolderBtn">+ Create New Folder</button>
                <div class="media-section" id="studyMedia"></div>
            </section>
        </div>

        <!-- Daily Vlog åŒºåŸŸ - å•ä¸ªåŠ å·æŒ‰é’® -->
        <div id="vlog" class="page-content" style="display: none;">
            <h2 class="page-title">ğŸ¥ Daily Vlog</h2>
            <section class="content-section">
                <h3 class="section-title">My Daily Life</h3>
                <button class="add-folder-btn" id="vlogAddFolderBtn">+ Create New Folder</button>
                <div class="media-section" id="vlogMedia"></div>
            </section>
        </div>

        <!-- Week Diary åŒºåŸŸ - å•ä¸ªåŠ å·æŒ‰é’® -->
        <div id="week" class="page-content" style="display: none;">
            <h2 class="page-title">ğŸ“– Week Diary</h2>
            <section class="content-section">
                <h3 class="section-title">Weekly Reflections</h3>
                <button class="add-folder-btn" id="weekAddFolderBtn">+ Create New Folder</button>
                <div class="media-section" id="weekMedia"></div>
            </section>
        </div>

        <!-- Achievements Showcase åŒºåŸŸ - å•ä¸ªåŠ å·æŒ‰é’® -->
        <div id="achieve" class="page-content" style="display: none;">
            <h2 class="page-title">ğŸ† Achievements Showcase</h2>
            <section class="content-section">
                <h3 class="section-title">My Accomplishments</h3>
                <button class="add-folder-btn" id="achieveAddFolderBtn">+ Create New Folder</button>
                <div class="media-section" id="achieveMedia"></div>
            </section>
        </div>

        <!-- Personal Target åŒºåŸŸ -->
        <div id="target" class="page-content" style="display: none;">
            <h2 class="page-title">ğŸ¯ Personal Target</h2>
            <section class="content-section personal-target">
                <h3 class="section-title">My Goals & Dreams</h3>
                <button class="add-target-btn" id="addTargetBtn">+ Add Target</button>
                <div class="target-list" id="targetList"></div>
            </section>
        </div>
    </div>

    <!-- åˆ›å»ºæ–‡ä»¶å¤¹å¼¹çª— - æ”¯æŒä¸Šä¼ è‡ªå®šä¹‰icon -->
    <div class="overlay" id="createFolderOverlay"></div>
    <div class="create-folder-modal" id="createFolderModal">
        <h3 style="color: #ff66b3; text-align: center; margin-bottom: 1rem;">Create New Folder</h3>
        <input type="text" id="newFolderNameInput" placeholder="Enter folder name (e.g. Math Homework)">
        
        <!-- æ–‡ä»¶å¤¹å›¾æ ‡ä¸Šä¼ åŒºåŸŸ -->
        <div class="folder-icon-upload" id="folderIconUpload">
            <p style="color: #ff66b3;">ğŸ“ Click to upload folder icon</p>
            <div class="icon-preview" id="folderIconPreview">ğŸ“</div>
            <input type="file" id="folderIconFileInput" accept="image/*" style="display: none;">
        </div>
        
        <div style="display: flex; justify-content: center; gap: 10px; margin-top: 1rem;">
            <button id="confirmCreateFolderBtn" class="confirmCreateFolderBtn">Create</button>
            <button id="cancelCreateFolderBtn" class="cancelCreateFolderBtn">Cancel</button>
        </div>
    </div>

    <!-- æ–‡ä»¶å¤¹è¯¦æƒ…é¡µé¢å¼¹çª—ï¼ˆæ–°ç½‘é¡µï¼‰ -->
    <div class="overlay" id="folderPageOverlay"></div>
    <div class="folder-page-modal" id="folderPageModal">
        <h3 style="color: #ff66b3; text-align: center; margin-bottom: 1rem;" id="folderPageTitle">Folder Content</h3>
        <button class="upload-media-btn" id="uploadMediaBtn">+ Upload Photo/Video</button>
        <div class="media-section" id="folderMediaContent"></div>
        <div style="display: flex; justify-content: center; gap: 10px; margin-top: 1rem;">
            <button id="closeFolderPageBtn" class="close-folder-page">Close</button>
        </div>
    </div>

    <!-- ä¸ªäººç›®æ ‡å¼¹çª— -->
    <div class="overlay" id="targetOverlay"></div>
    <div class="target-modal" id="targetModal">
        <h3 style="color: #ff66b3; text-align: center; margin-bottom: 1rem;">Add/Edit Target</h3>
        <div class="target-form">
            <input type="text" id="targetYear" placeholder="Enter year (e.g. 2024)">
            <input type="text" id="targetContent" placeholder="Enter target (e.g. Learn JavaScript)">
            <input type="hidden" id="targetId">
            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 1rem;">
                <button id="saveTargetBtn" class="saveTargetBtn">Save</button>
                <button id="cancelTargetBtn" class="cancelTargetBtn">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // æ ¸å¿ƒå˜é‡
        const ADMIN_PASSWORD = "Shining0325";
        let isAdmin = false;
        let currentMediaSection = "";
        let currentFolderId = ""; // å½“å‰æ‰“å¼€çš„æ–‡ä»¶å¤¹ID
        let folderIcons = {}; // å­˜å‚¨æ–‡ä»¶å¤¹å›¾æ ‡
        let folderNames = {}; // å­˜å‚¨æ–‡ä»¶å¤¹åç§°
        let folderContents = {}; // å­˜å‚¨æ–‡ä»¶å¤¹å†…çš„åª’ä½“æ–‡ä»¶
        let targets = [];
        let targetIdCounter = 1;

        // é¡µé¢å¯¼èˆªåŠŸèƒ½
        function navigateTo(pageId) {
            // éšè—æ‰€æœ‰é¡µé¢
            const allPages = document.querySelectorAll('.page-content');
            allPages.forEach(page => {
                page.style.display = 'none';
            });
            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            document.getElementById(pageId).style.display = 'block';
        }

        // DOM å…ƒç´ 
        const loginBtn = document.getElementById("loginBtn");
        const loginModal = document.getElementById("loginModal");
        const loginOverlay = document.getElementById("loginOverlay");
        const passwordInput = document.getElementById("passwordInput");
        const submitLogin = document.getElementById("submitLogin");
        const loginError = document.getElementById("loginError");
        
        // é€€å‡ºç¼–è¾‘æ¨¡å¼ç›¸å…³
        const exitEditModal = document.getElementById("exitEditModal");
        const exitEditOverlay = document.getElementById("exitEditOverlay");
        const confirmExitEdit = document.getElementById("confirmExitEdit");
        const cancelExitEdit = document.getElementById("cancelExitEdit");

        // ç®¡ç†å‘˜æŒ‰é’®ï¼ˆå•ä¸ªåŠ å·æŒ‰é’®ï¼‰
        const addFolderBtns = document.querySelectorAll(".add-folder-btn");
        const addTargetBtn = document.getElementById("addTargetBtn");

        // åˆ›å»ºæ–‡ä»¶å¤¹ç›¸å…³
        const createFolderModal = document.getElementById("createFolderModal");
        const createFolderOverlay = document.getElementById("createFolderOverlay");
        const newFolderNameInput = document.getElementById("newFolderNameInput");
        const folderIconUpload = document.getElementById("folderIconUpload");
        const folderIconFileInput = document.getElementById("folderIconFileInput");
        const folderIconPreview = document.getElementById("folderIconPreview");
        const confirmCreateFolderBtn = document.getElementById("confirmCreateFolderBtn");
        const cancelCreateFolderBtn = document.getElementById("cancelCreateFolderBtn");

        // æ–‡ä»¶å¤¹è¯¦æƒ…é¡µé¢ç›¸å…³
        const folderPageModal = document.getElementById("folderPageModal");
        const folderPageOverlay = document.getElementById("folderPageOverlay");
        const folderPageTitle = document.getElementById("folderPageTitle");
        const folderMediaContent = document.getElementById("folderMediaContent");
        const uploadMediaBtn = document.getElementById("uploadMediaBtn");
        const closeFolderPageBtn = document.getElementById("closeFolderPageBtn");

        // ç›®æ ‡ç›¸å…³
        const targetModal = document.getElementById("targetModal");
        const targetOverlay = document.getElementById("targetOverlay");
        const targetYear = document.getElementById("targetYear");
        const targetContent = document.getElementById("targetContent");
        const targetId = document.getElementById("targetId");
        const saveTargetBtn = document.getElementById("saveTargetBtn");
        const cancelTargetBtn = document.getElementById("cancelTargetBtn");
        const targetList = document.getElementById("targetList");

        // ç™»å½•/é€€å‡ºç¼–è¾‘åŠŸèƒ½
        loginBtn.addEventListener("click", () => {
            if (!isAdmin) {
                // æœªç™»å½• - æ˜¾ç¤ºç™»å½•å¼¹çª—
                loginModal.style.display = "block";
                loginOverlay.style.display = "block";
                passwordInput.focus();
            } else {
                // å·²ç™»å½• - æ˜¾ç¤ºé€€å‡ºç¼–è¾‘ç¡®è®¤å¼¹çª—
                exitEditModal.style.display = "block";
                exitEditOverlay.style.display = "block";
            }
        });

        // ç¡®è®¤é€€å‡ºç¼–è¾‘æ¨¡å¼
        confirmExitEdit.addEventListener("click", () => {
            isAdmin = false;
            exitEditModal.style.display = "none";
            exitEditOverlay.style.display = "none";
            
            // éšè—æ‰€æœ‰ç®¡ç†å‘˜æŒ‰é’®
            addFolderBtns.forEach(btn => btn.style.display = "none");
            addTargetBtn.style.display = "none";
            
            // éšè—æ‰€æœ‰åˆ é™¤æŒ‰é’®
            document.querySelectorAll('.delete-folder, .delete-file, .target-edit').forEach(el => {
                el.style.display = 'none';
            });
            
            // ç¦ç”¨æ‰€æœ‰ç¼–è¾‘åŠŸèƒ½
            document.querySelectorAll('[contenteditable="true"]').forEach(el => {
                el.contentEditable = false;
            });
            
            alert("âœ¨ Edit mode ended! You can no longer modify content.");
        });

        // å–æ¶ˆé€€å‡ºç¼–è¾‘æ¨¡å¼
        cancelExitEdit.addEventListener("click", () => {
            exitEditModal.style.display = "none";
            exitEditOverlay.style.display = "none";
        });

        exitEditOverlay.addEventListener("click", () => {
            exitEditModal.style.display = "none";
            exitEditOverlay.style.display = "none";
        });

        loginOverlay.addEventListener("click", () => {
            loginModal.style.display = "none";
            loginOverlay.style.display = "none";
            loginError.style.display = "none";
        });

        submitLogin.addEventListener("click", () => {
            if (passwordInput.value === ADMIN_PASSWORD) {
                isAdmin = true;
                loginModal.style.display = "none";
                loginOverlay.style.display = "none";
                // æ˜¾ç¤ºæ‰€æœ‰ç®¡ç†å‘˜æŒ‰é’®
                addFolderBtns.forEach(btn => btn.style.display = "inline-block");
                addTargetBtn.style.display = "inline-block";
                // æ˜¾ç¤ºæ‰€æœ‰å·²å­˜åœ¨çš„åˆ é™¤æŒ‰é’®
                document.querySelectorAll('.delete-folder, .delete-file, .target-edit').forEach(el => {
                    el.style.display = el.classList.contains('delete-folder') || el.classList.contains('delete-file') ? 'flex' : 'inline';
                });
                // å¯ç”¨ç¼–è¾‘åŠŸèƒ½
                document.querySelectorAll('[contenteditable="true"]').forEach(el => {
                    el.contentEditable = true;
                });
                alert("âœ¨ Edit mode begin! You can now create folders and manage content.");
            } else {
                loginError.style.display = "block";
                passwordInput.value = "";
            }
        });

        // æ–‡ä»¶å¤¹å›¾æ ‡ä¸Šä¼ 
        folderIconUpload.addEventListener("click", () => {
            folderIconFileInput.click();
        });

        folderIconFileInput.addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    folderIconPreview.innerHTML = `<img src="${event.target.result}" width="80" height="80" style="object-fit: contain; border-radius: 10px;">`;
                };
                reader.readAsDataURL(file);
            }
        });

        // æ‰“å¼€åˆ›å»ºæ–‡ä»¶å¤¹å¼¹çª—
        function openCreateFolderModal(section) {
            if (!isAdmin) return;
            
            currentMediaSection = section;
            createFolderModal.style.display = "block";
            createFolderOverlay.style.display = "block";
            newFolderNameInput.value = "";
            folderIconPreview.innerHTML = "ğŸ“"; // é‡ç½®é¢„è§ˆ
            folderIconFileInput.value = ""; // é‡ç½®æ–‡ä»¶è¾“å…¥
            // è‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†
            setTimeout(() => {
                newFolderNameInput.focus();
            }, 100);
        }

        // å…³é—­åˆ›å»ºæ–‡ä»¶å¤¹å¼¹çª—
        cancelCreateFolderBtn.addEventListener("click", () => {
            createFolderModal.style.display = "none";
            createFolderOverlay.style.display = "none";
        });

        createFolderOverlay.addEventListener("click", () => {
            createFolderModal.style.display = "none";
            createFolderOverlay.style.display = "none";
        });

        // åˆ›å»ºæ–‡ä»¶å¤¹
        confirmCreateFolderBtn.addEventListener("click", () => {
            const folderName = newFolderNameInput.value.trim();
            if (!folderName) {
                alert("Please enter a folder name!");
                newFolderNameInput.focus();
                return;
            }

            const mediaSection = document.getElementById(`${currentMediaSection}Media`);
            const folderId = `folder_${Date.now()}`;
            
            // ä¿å­˜æ–‡ä»¶å¤¹åç§°
            folderNames[folderId] = folderName;
            
            // ä¿å­˜æ–‡ä»¶å¤¹å›¾æ ‡
            const iconPreviewContent = folderIconPreview.innerHTML;
            if (iconPreviewContent.includes('img src=')) {
                const imgSrc = iconPreviewContent.match(/src="(.*?)"/)[1];
                folderIcons[folderId] = imgSrc;
            } else {
                // é»˜è®¤å›¾æ ‡
                folderIcons[folderId] = "https://via.placeholder.com/70/ff66b3/ffffff?text=ğŸ“";
            }
            
            // åˆå§‹åŒ–æ–‡ä»¶å¤¹å†…å®¹
            folderContents[folderId] = [];

            // åˆ›å»ºæ–‡ä»¶å¤¹å…ƒç´ 
            const folderItem = document.createElement("div");
            folderItem.className = "folder-item";
            folderItem.dataset.id = folderId;
            
            // æ–‡ä»¶å¤¹HTMLç»“æ„
            folderItem.innerHTML = `
                <button class="delete-folder" style="display: ${isAdmin ? "flex" : "none"}">Ã—</button>
                <img src="${folderIcons[folderId]}" class="folder-icon" alt="${folderName}">
                <div class="folder-name" contenteditable="${isAdmin}">${folderName}</div>
            `;

            // æ–‡ä»¶å¤¹åç§°ç¼–è¾‘
            const folderNameEl = folderItem.querySelector('.folder-name');
            folderNameEl.addEventListener("keydown", (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    folderNameEl.blur(); // å¤±å»ç„¦ç‚¹å®Œæˆç¼–è¾‘
                }
            });

            folderNameEl.addEventListener("blur", () => {
                const newName = folderNameEl.textContent.trim() || "New Folder";
                folderNameEl.textContent = newName;
                folderNames[folderId] = newName; // æ›´æ–°åç§°
            });

            // åˆ é™¤æ–‡ä»¶å¤¹åŠŸèƒ½ï¼ˆåˆ é™¤é”®1ï¼‰
            const deleteBtn = folderItem.querySelector(".delete-folder");
            deleteBtn.addEventListener("click", (e) => {
                e.stopPropagation(); // é˜²æ­¢è§¦å‘æ–‡ä»¶å¤¹æ‰“å¼€
                if (confirm(`Are you sure to delete the folder "${folderNameEl.textContent}"?\nAll contents inside will also be deleted.`)) {
                    // æ¸…ç†æ–‡ä»¶URL
                    if (folderContents[folderId]) {
                        folderContents[folderId].forEach(file => {
                            if (file.url && file.url.startsWith('blob:')) {
                                URL.revokeObjectURL(file.url);
                            }
                        });
                    }
                    // åˆ é™¤æ–‡ä»¶å¤¹
                    mediaSection.removeChild(folderItem);
                    delete folderIcons[folderId];
                    delete folderNames[folderId];
                    delete folderContents[folderId];
                }
            });

            // ç‚¹å‡»æ–‡ä»¶å¤¹æ‰“å¼€æ–°ç½‘é¡µï¼ˆå¼¹çª—å½¢å¼ï¼‰
            folderItem.addEventListener("click", (e) => {
                // å¿½ç•¥åˆ é™¤æŒ‰é’®å’Œåç§°ç¼–è¾‘åŒºåŸŸçš„ç‚¹å‡»
                if (e.target.classList.contains('delete-folder') || 
                    e.target.classList.contains('folder-name')) {
                    return;
                }
                
                openFolderPage(folderId);
            });

            // æ·»åŠ åˆ°åª’ä½“åŒºåŸŸ
            mediaSection.appendChild(folderItem);
            
            // åˆ›å»ºåè‡ªåŠ¨è¿›å…¥é‡å‘½åæ¨¡å¼
            setTimeout(() => {
                folderNameEl.focus();
                // é€‰ä¸­æ‰€æœ‰æ–‡æœ¬ä»¥ä¾¿ç›´æ¥è¾“å…¥
                const range = document.createRange();
                const sel = window.getSelection();
                range.selectNodeContents(folderNameEl);
                sel.removeAllRanges();
                sel.addRange(range);
            }, 200);

            // å…³é—­å¼¹çª—
            createFolderModal.style.display = "none";
            createFolderOverlay.style.display = "none";
        });

        // æ‰“å¼€æ–‡ä»¶å¤¹è¯¦æƒ…é¡µé¢ï¼ˆæ–°ç½‘é¡µï¼‰
        function openFolderPage(folderId) {
            currentFolderId = folderId;
            folderPageTitle.textContent = folderNames[folderId] || "Folder Content";
            folderPageModal.style.display = "block";
            folderPageOverlay.style.display = "block";
            
            // æ¸²æŸ“æ–‡ä»¶å¤¹å†…çš„åª’ä½“æ–‡ä»¶
            renderFolderMedia(folderId);
        }

        // å…³é—­æ–‡ä»¶å¤¹è¯¦æƒ…é¡µé¢
        closeFolderPageBtn.addEventListener("click", () => {
            folderPageModal.style.display = "none";
            folderPageOverlay.style.display = "none";
            currentFolderId = "";
        });

        folderPageOverlay.addEventListener("click", () => {
            folderPageModal.style.display = "none";
            folderPageOverlay.style.display = "none";
            currentFolderId = "";
        });

        // æ¸²æŸ“æ–‡ä»¶å¤¹å†…çš„åª’ä½“æ–‡ä»¶
        function renderFolderMedia(folderId) {
            folderMediaContent.innerHTML = "";
            
            if (!folderContents[folderId]) return;
            
            folderContents[folderId].forEach((file, index) => {
                const fileItem = document.createElement("div");
                fileItem.className = "file-item";
                fileItem.dataset.index = index;
                
                // åˆ›å»ºæ–‡ä»¶é¢„è§ˆ
                let filePreview = "";
                if (file.type.startsWith("image/")) {
                    filePreview = `<img src="${file.url}" class="file-icon" alt="${file.name}">`;
                } else if (file.type.startsWith("video/")) {
                    filePreview = `<video src="${file.url}" class="file-icon" controls muted playsinline></video>`;
                } else {
                    filePreview = `<div class="file-icon" style="background: #ffd6e8; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #ff66b3;">ğŸ“„</div>`;
                }

                // æ–‡ä»¶HTMLç»“æ„
                fileItem.innerHTML = `
                    <button class="delete-file" style="display: ${isAdmin ? "flex" : "none"}">Ã—</button>
                    ${filePreview}
                    <div class="file-name" contenteditable="${isAdmin}">${file.name}</div>
                `;

                // æ–‡ä»¶åç§°ç¼–è¾‘
                const fileNameEl = fileItem.querySelector('.file-name');
                fileNameEl.addEventListener("keydown", (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        fileNameEl.blur(); // å¤±å»ç„¦ç‚¹å®Œæˆç¼–è¾‘
                    }
                });

                fileNameEl.addEventListener("blur", () => {
                    const newName = fileNameEl.textContent.trim() || file.originalName;
                    fileNameEl.textContent = newName;
                    // æ›´æ–°æ–‡ä»¶å
                    folderContents[folderId][index].name = newName;
                });

                // æ–‡ä»¶åˆ é™¤åŠŸèƒ½ï¼ˆåˆ é™¤é”®1ï¼‰
                const deleteFileBtn = fileItem.querySelector(".delete-file");
                deleteFileBtn.addEventListener("click", (e) => {
                    e.stopPropagation();
                    if (confirm(`Are you sure to delete "${fileNameEl.textContent}"?`)) {
                        // é‡Šæ”¾æ–‡ä»¶URL
                        if (file.url && file.url.startsWith('blob:')) {
                            URL.revokeObjectURL(file.url);
                        }
                        // åˆ é™¤æ–‡ä»¶
                        folderContents[folderId].splice(index, 1);
                        renderFolderMedia(folderId); // é‡æ–°æ¸²æŸ“
                    }
                });

                // æ·»åŠ åˆ°æ–‡ä»¶å¤¹å†…å®¹åŒºåŸŸ
                folderMediaContent.appendChild(fileItem);
                
                // è‡ªåŠ¨è¿›å…¥é‡å‘½åæ¨¡å¼ï¼ˆä»…æ–°ä¸Šä¼ çš„æ–‡ä»¶ï¼‰
                if (file.isNew) {
                    setTimeout(() => {
                        fileNameEl.focus();
                        const range = document.createRange();
                        const sel = window.getSelection();
                        range.selectNodeContents(fileNameEl);
                        sel.removeAllRanges();
                        sel.addRange(range);
                        file.isNew = false; // é‡ç½®æ ‡è®°
                    }, 200);
                }
            });
        }

        // æ–‡ä»¶å¤¹å†…ä¸Šä¼ åª’ä½“æ–‡ä»¶
        uploadMediaBtn.addEventListener("click", () => {
            if (!isAdmin) return;
            
            const fileInput = document.createElement("input");
            fileInput.type = "file";
            fileInput.accept = "image/*,video/*";
            fileInput.multiple = true;

            fileInput.click();

            fileInput.addEventListener("change", (e) => {
                const files = e.target.files;
                if (!files.length || !currentFolderId) return;

                // åˆå§‹åŒ–æ–‡ä»¶å¤¹å†…å®¹æ•°ç»„
                if (!folderContents[currentFolderId]) {
                    folderContents[currentFolderId] = [];
                }

                // æ‰¹é‡ä¸Šä¼ æ–‡ä»¶
                for (let file of files) {
                    const fileUrl = URL.createObjectURL(file);
                    
                    // æ·»åŠ æ–‡ä»¶åˆ°æ–‡ä»¶å¤¹
                    folderContents[currentFolderId].push({
                        name: file.name,
                        originalName: file.name,
                        type: file.type,
                        url: fileUrl,
                        isNew: true // æ ‡è®°ä¸ºæ–°æ–‡ä»¶ï¼Œç”¨äºè‡ªåŠ¨é‡å‘½å
                    });
                }

                // é‡æ–°æ¸²æŸ“æ–‡ä»¶å¤¹å†…å®¹
                renderFolderMedia(currentFolderId);
            });
        });

        // ç»‘å®šåˆ›å»ºæ–‡ä»¶å¤¹æŒ‰é’®ï¼ˆæ¯ä¸ªsectionä¸€ä¸ªåŠ å·æŒ‰é’®ï¼‰
        document.getElementById("studyAddFolderBtn").addEventListener("click", () => openCreateFolderModal("study"));
        document.getElementById("vlogAddFolderBtn").addEventListener("click", () => openCreateFolderModal("vlog"));
        document.getElementById("weekAddFolderBtn").addEventListener("click", () => openCreateFolderModal("week"));
        document.getElementById("achieveAddFolderBtn").addEventListener("click", () => openCreateFolderModal("achieve"));

        // ä¸ªäººç›®æ ‡åŠŸèƒ½
        function renderTargets() {
            targetList.innerHTML = "";
            targets.forEach(target => {
                const targetItem = document.createElement("div");
                targetItem.className = `target-item ${target.completed ? "completed" : ""}`;
                targetItem.innerHTML = `
                    <input type="checkbox" class="target-checkbox" ${target.completed ? "checked" : ""} data-id="${target.id}">
                    <div class="target-content">
                        <strong>${target.year}</strong>: ${target.content}
                    </div>
                    <span class="target-edit" data-id="${target.id}" style="${isAdmin ? "display: inline" : "none"}">âœï¸ Edit</span>
                `;

                // å‹¾é€‰/å–æ¶ˆå‹¾é€‰
                targetItem.querySelector(".target-checkbox").addEventListener("change", (e) => {
                    const id = parseInt(e.target.dataset.id);
                    const target = targets.find(t => t.id === id);
                    if (target) {
                        target.completed = e.target.checked;
                        renderTargets();
                    }
                });

                // ç¼–è¾‘ç›®æ ‡
                targetItem.querySelector(".target-edit").addEventListener("click", (e) => {
                    const id = parseInt(e.target.dataset.id);
                    const target = targets.find(t => t.id === id);
                    if (target) {
                        targetId.value = target.id;
                        targetYear.value = target.year;
                        targetContent.value = target.content;
                        targetModal.style.display = "block";
                        targetOverlay.style.display = "block";
                    }
                });

                targetList.appendChild(targetItem);
            });
        }

        // æ‰“å¼€æ·»åŠ ç›®æ ‡å¼¹çª—
        addTargetBtn.addEventListener("click", () => {
            targetId.value = "";
            targetYear.value = "";
            targetContent.value = "";
            targetModal.style.display = "block";
            targetOverlay.style.display = "block";
            targetYear.focus();
        });

        // å…³é—­ç›®æ ‡å¼¹çª—
        cancelTargetBtn.addEventListener("click", () => {
            targetModal.style.display = "none";
            targetOverlay.style.display = "none";
        });

        targetOverlay.addEventListener("click", () => {
            targetModal.style.display = "none";
            targetOverlay.style.display = "none";
        });

        // ä¿å­˜ç›®æ ‡
        saveTargetBtn.addEventListener("click", () => {
            const year = targetYear.value.trim();
            const content = targetContent.value.trim();
            
            if (!year || !content) {
                alert("Please fill in both year and target content!");
                if (!year) targetYear.focus();
                else targetContent.focus();
                return;
            }

            if (targetId.value) {
                // ç¼–è¾‘ç°æœ‰ç›®æ ‡
                const id = parseInt(targetId.value);
                const target = targets.find(t => t.id === id);
                if (target) {
                    target.year = year;
                    target.content = content;
                }
            } else {
                // æ·»åŠ æ–°ç›®æ ‡
                targets.push({
                    id: targetIdCounter++,
                    year: year,
                    content: content,
                    completed: false
                });
            }

            renderTargets();
            targetModal.style.display = "none";
            targetOverlay.style.display = "none";
        });

        // åˆå§‹åŒ–
        function init() {
            renderTargets();
            // é»˜è®¤æ˜¾ç¤ºé¦–é¡µ
            navigateTo('home');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener("load", init);

        // ç‚¹å‡»ç©ºç™½å¤„å®Œæˆç¼–è¾‘
        document.addEventListener("click", (e) => {
            // å¦‚æœç‚¹å‡»çš„æ˜¯ç©ºç™½åŒºåŸŸï¼Œå¹¶ä¸”æœ‰å…ƒç´ å¤„äºç¼–è¾‘çŠ¶æ€
            const activeElement = document.activeElement;
            if (activeElement && activeElement.isContentEditable && 
                !activeElement.contains(e.target) && 
                !['INPUT', 'TEXTAREA', 'BUTTON'].includes(e.target.tagName)) {
                activeElement.blur();
            }
        });

        // ç¡®ä¿ç®¡ç†å‘˜ç™»å½•å–æ¶ˆåéšè—æŒ‰é’®
        window.addEventListener("beforeunload", () => {
            isAdmin = false;
        });
    </script>
</body>
</html>
